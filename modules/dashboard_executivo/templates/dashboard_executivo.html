{% extends "base.html" %}

{% block title %}Dashboard Executivo - Portal UniSystem{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{{ url_for('dashboard_executivo.static', filename='css/dashboard.css') }}">
{% endblock %}

{% block content %}
<div class="dashboard-container">
    <!-- Loading Overlay -->
    <div id="loading-overlay" class="loading-overlay">
        <div class="loading-spinner">
            <div class="spinner"></div>
            <p>Carregando dados...</p>
        </div>
    </div>

    <!-- Actions Bar with Breadcrumb -->
    <div class="actions-bar">
        <div class="actions-left">
            {{ breadcrumb([
                {'name': 'Menu', 'icon': 'mdi mdi-menu', 'url': url_for('menu.menu_home')},
                {'name': 'Dashboards', 'icon': 'mdi mdi-view-dashboard', 'url': url_for('menu.dashboards')},
                {'name': 'Dashboard Executivo', 'icon': 'mdi mdi-chart-line'}
            ]) }}
        </div>
        <div class="actions-right">
            <!-- Bot√µes de a√ß√£o podem ser adicionados aqui se necess√°rio -->
        </div>
    </div>
    
    <!-- KPI Cards -->
    <div class="kpi-grid">
        <div class="kpi-card">
            <div class="kpi-value" id="kpi-total-processos">-</div>
            <div class="kpi-label">Total de Processos</div>
        </div>
        <div class="kpi-card">
            <div class="kpi-value" id="kpi-total-despesas">-</div>
            <div class="kpi-label">Total de Despesas</div>
        </div>
        <div class="kpi-card">
            <div class="kpi-value" id="kpi-ticket-medio">-</div>
            <div class="kpi-label">Ticket M√©dio</div>
        </div>
        <div class="kpi-card">
            <div class="kpi-value" id="kpi-em-transito">-</div>
            <div class="kpi-label">Em Tr√¢nsito</div>
        </div>
        <div class="kpi-card">
            <div class="kpi-value" id="kpi-total-agd-embarque">-</div>
            <div class="kpi-label">Aguardando Embarque</div>
        </div>
        <div class="kpi-card">
            <div class="kpi-value" id="kpi-total-ag-chegada">-</div>
            <div class="kpi-label">Aguardando Chegada</div>
        </div>
        <div class="kpi-card">
            <div class="kpi-value" id="kpi-chegando-mes">-</div>
            <div class="kpi-label">Chegando Este M√™s</div>
            <div class="kpi-sub-value" id="kpi-chegando-mes-custo">-</div>
        </div>
        <div class="kpi-card">
            <div class="kpi-value" id="kpi-chegando-semana">-</div>
            <div class="kpi-label">Chegando Esta Semana</div>
            <div class="kpi-sub-value" id="kpi-chegando-semana-custo">-</div>
        </div>
        <div class="kpi-card">
            <div class="kpi-value" id="kpi-transit-time">-</div>
            <div class="kpi-label">Transit Time M√©dio</div>
        </div>
        <div class="kpi-card">
            <div class="kpi-value" id="kpi-proc-mes">-</div>
            <div class="kpi-label">Processos/M√™s</div>
        </div>
        <div class="kpi-card">
            <div class="kpi-value" id="kpi-proc-semana">-</div>
            <div class="kpi-label">Processos/Semana</div>
        </div>
    </div>
    
    <!-- Charts Grid -->
    <div class="charts-grid">
        <!-- Monthly Evolution Chart (70% width) -->
        <div class="chart-section">
            <div class="chart-header">
                <h2 class="chart-title">Evolu√ß√£o Mensal</h2>
                <div class="period-controls">
                    <button class="period-btn active" data-period="mensal">Mensal</button>
                    <button class="period-btn" data-period="semanal">Semanal</button>
                    <button class="period-btn" data-period="diario">Di√°rio</button>
                </div>
            </div>
            <div class="chart-container">
                <canvas id="monthly-chart" class="chart-canvas"></canvas>
            </div>
        </div>
        
        <!-- Status Chart -->
        <div class="chart-section">
            <div class="chart-header">
                <h2 class="chart-title">Distribui√ß√£o por Status</h2>
            </div>
            <div class="chart-container">
                <canvas id="status-chart" class="chart-canvas"></canvas>
            </div>
        </div>
        
        <!-- Modal Chart (30% width) -->
        <div class="chart-section">
            <div class="chart-header">
                <h2 class="chart-title">Processos e Custos por Modal</h2>
            </div>
            <div class="chart-container">
                <canvas id="grouped-modal-chart" class="chart-canvas"></canvas>
            </div>
        </div>
        
        <!-- URF Chart -->
        <div class="chart-section">
            <div class="chart-header">
                <h2 class="chart-title">Top 10 URFs</h2>
            </div>
            <div class="chart-container">
                <canvas id="urf-chart" class="chart-canvas"></canvas>
            </div>
        </div>
        
        <!-- Material Chart -->
        <div class="chart-section">
            <div class="chart-header">
                <h2 class="chart-title">Top 10 Materiais</h2>
            </div>
            <div class="chart-container">
                <canvas id="material-chart" class="chart-canvas"></canvas>
            </div>
        </div>
    </div>
    
    <!-- Recent Operations Table -->
    <div class="table-section">
        <div class="table-header">
            <h2 class="table-title">Opera√ß√µes Recentes</h2>
            <div class="table-controls">
                <button id="export-data" class="btn btn-secondary">üìä Exportar</button>
            </div>
        </div>
        <div class="table-container">
            <table id="recent-operations-table" class="data-table">
                <thead>
                    <tr>
                        <th>A√ß√µes</th>
                        <th>Ref. Unique</th>
                        <th>Importador</th>
                        <th>Data Abertura</th>
                        <th>Exportador</th>
                        <th>Modal</th>
                        <th>Status</th>
                        <th>Custo Total</th>
                        <th>Data Chegada</th>
                        <th>Material</th>
                        <th>URF</th>
                    </tr>
                </thead>
                <tbody>
                    <!-- Dados carregados dinamicamente -->
                </tbody>
            </table>
        </div>
    </div>

    <!-- Modal de Detalhes do Processo -->
    <div id="process-modal" class="modal-overlay">
        <div class="modal-container">
            <!-- Modal Header -->
            <div class="modal-header">
                <h2 class="modal-title" id="modal-title">Detalhes do Processo</h2>
                <button class="modal-close" id="modal-close">
                    <i class="mdi mdi-close"></i>
                </button>
            </div>

            <!-- Modal Content -->
            <div class="modal-content">
                <!-- Timeline do Processo -->
                <div class="process-timeline">
                    <div class="timeline-step" data-step="1">
                        <div class="timeline-icon">
                            <i class="mdi mdi-file-document-outline"></i>
                        </div>
                        <div class="timeline-label">Abertura</div>
                    </div>
                    <div class="timeline-step" data-step="2">
                        <div class="timeline-icon">
                            <i class="mdi mdi-ship"></i>
                        </div>
                        <div class="timeline-label">Embarque</div>
                    </div>
                    <div class="timeline-step" data-step="3">
                        <div class="timeline-icon">
                            <i class="mdi mdi-airplane-landing"></i>
                        </div>
                        <div class="timeline-label">Chegada</div>
                    </div>
                    <div class="timeline-step" data-step="4">
                        <div class="timeline-icon">
                            <i class="mdi mdi-check-circle-outline"></i>
                        </div>
                        <div class="timeline-label">Desembara√ßo</div>
                    </div>
                    <div class="timeline-step" data-step="5">
                        <div class="timeline-icon">
                            <i class="mdi mdi-flag-checkered"></i>
                        </div>
                        <div class="timeline-label">Finalizado</div>
                    </div>
                </div>

                <!-- Cards de Informa√ß√µes -->
                <div class="modal-cards">
                    <!-- Card 1: Informa√ß√µes Gerais -->
                    <div class="info-card">
                        <h3 class="card-title">Informa√ß√µes Gerais</h3>
                        <div class="card-grid-3">
                            <div class="info-item">
                                <label>Ref. Unique:</label>
                                <span id="detail-ref-unique">-</span>
                            </div>
                            <div class="info-item">
                                <label>Ref. Importador:</label>
                                <span id="detail-ref-importador">-</span>
                            </div>
                            <div class="info-item">
                                <label>Data de Abertura:</label>
                                <span id="detail-data-abertura">-</span>
                            </div>
                            <div class="info-item">
                                <label>Importador:</label>
                                <span id="detail-importador">-</span>
                            </div>
                            <div class="info-item">
                                <label>CNPJ:</label>
                                <span id="detail-cnpj">-</span>
                            </div>
                            <div class="info-item">
                                <label>Status Atual:</label>
                                <span id="detail-status" class="status-badge">-</span>
                            </div>
                        </div>
                    </div>

                    <!-- Card 2: Detalhes da Carga e Transporte -->
                    <div class="info-card">
                        <h3 class="card-title">Detalhes da Carga e Transporte</h3>
                        <div class="card-grid-2">
                            <div class="info-item">
                                <label>Modal:</label>
                                <span id="detail-modal">-</span>
                            </div>
                            <div class="info-item">
                                <label>Container:</label>
                                <span id="detail-container">-</span>
                            </div>
                            <div class="info-item">
                                <label>Data de Embarque:</label>
                                <span id="detail-data-embarque">-</span>
                            </div>
                            <div class="info-item">
                                <label>Data de Chegada:</label>
                                <span id="detail-data-chegada">-</span>
                            </div>
                            <div class="info-item">
                                <label>Transit Time (dias):</label>
                                <span id="detail-transit-time">-</span>
                            </div>
                            <div class="info-item">
                                <label>Peso Bruto (Kg):</label>
                                <span id="detail-peso-bruto">-</span>
                            </div>
                        </div>
                    </div>

                    <!-- Card 3: Informa√ß√µes Aduaneiras -->
                    <div class="info-card">
                        <h3 class="card-title">Informa√ß√µes Aduaneiras</h3>
                        <div class="card-grid-2">
                            <div class="info-item">
                                <label>N√∫mero da DI:</label>
                                <span id="detail-numero-di">-</span>
                            </div>
                            <div class="info-item">
                                <label>Data de Registro DI:</label>
                                <span id="detail-data-registro">-</span>
                            </div>
                            <div class="info-item">
                                <label>Canal:</label>
                                <span id="detail-canal">-</span>
                            </div>
                            <div class="info-item">
                                <label>Data do Desembara√ßo:</label>
                                <span id="detail-data-desembaraco">-</span>
                            </div>
                            <div class="info-item">
                                <label>URF de Entrada:</label>
                                <span id="detail-urf-entrada">-</span>
                            </div>
                            <div class="info-item">
                                <label>URF de Despacho:</label>
                                <span id="detail-urf-despacho">-</span>
                            </div>
                        </div>
                    </div>

                    <!-- Card 4: Resumo Financeiro -->
                    <div class="info-card">
                        <h3 class="card-title">Resumo Financeiro</h3>
                        <div class="card-grid-2">
                            <div class="info-item">
                                <label>Valor CIF (R$):</label>
                                <span id="detail-valor-cif">-</span>
                            </div>
                            <div class="info-item">
                                <label>Frete Internacional (R$):</label>
                                <span id="detail-frete-inter">-</span>
                            </div>
                            <div class="info-item">
                                <label>Armazenagem (R$):</label>
                                <span id="detail-armazenagem">-</span>
                            </div>
                            <div class="info-item">
                                <label>Honor√°rios (R$):</label>
                                <span id="detail-honorarios">-</span>
                            </div>
                            <div class="info-item">
                                <label>Outras Despesas (R$):</label>
                                <span id="detail-outras-despesas">-</span>
                            </div>
                            <div class="info-item total-item">
                                <label>Custo Total (R$):</label>
                                <span id="detail-custo-total" class="total-value">-</span>
                            </div>
                        </div>
                    </div>

                    <!-- Card 5: Documentos Anexados -->
                    <div class="info-card">
                        <h3 class="card-title">Documentos Anexados</h3>
                        <div class="documents-list" id="documents-list">
                            <p class="no-documents">Nenhum documento dispon√≠vel</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.2.0"></script>
<script src="{{ url_for('dashboard_executivo.static', filename='js/dashboard.js') }}"></script>
{% endblock %}
