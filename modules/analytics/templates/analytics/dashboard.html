{% extends "base.html" %}

{% block title %}Analytics Dashboard - UniSystem{% endblock %}

{% block head %}
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.js"></script>
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
<link rel="stylesheet" href="{{ url_for('analytics.static', filename='analytics/dashboard.css') }}">
{% endblock %}

{% block content %}
<div class="analytics-container">
    <!-- Header -->
    <div class="analytics-header">
        <div class="header-content">
            <div class="header-title">
                <div class="header-icon">
                    <i class="fas fa-chart-line"></i>
                </div>
                <h1>Analytics Dashboard</h1>
            </div>
            
            <div class="filters-container">
                <div class="filter-group">
                    <label for="periodFilter">Período:</label>
                    <select id="periodFilter" class="filter-select">
                        <option value="7">Últimos 7 dias</option>
                        <option value="30" selected>Últimos 30 dias</option>
                        <option value="90">Últimos 90 dias</option>
                    </select>
                </div>
                
                <button id="refreshBtn" class="refresh-btn">
                    <i class="fas fa-sync-alt"></i>
                    Atualizar
                </button>
            </div>
        </div>
    </div>

    <!-- Stats Cards -->
    <div class="stats-grid">
        <div class="stat-card">
            <div class="stat-header">
                <span class="stat-title">Total de Acessos</span>
                <div class="stat-icon primary">
                    <i class="fas fa-eye"></i>
                </div>
            </div>
            <div class="stat-value" id="totalAccess">-</div>
            <div class="stat-change positive">
                <i class="fas fa-arrow-up"></i>
                <span>Últimos 30 dias</span>
            </div>
        </div>

        <div class="stat-card">
            <div class="stat-header">
                <span class="stat-title">Usuários Únicos</span>
                <div class="stat-icon success">
                    <i class="fas fa-users"></i>
                </div>
            </div>
            <div class="stat-value" id="uniqueUsers">-</div>
            <div class="stat-change positive">
                <i class="fas fa-arrow-up"></i>
                <span>Usuários ativos</span>
            </div>
        </div>

        <div class="stat-card">
            <div class="stat-header">
                <span class="stat-title">Logins Hoje</span>
                <div class="stat-icon warning">
                    <i class="fas fa-sign-in-alt"></i>
                </div>
            </div>
            <div class="stat-value" id="loginsToday">-</div>
            <div class="stat-change positive">
                <i class="fas fa-arrow-up"></i>
                <span>Hoje</span>
            </div>
        </div>

        <div class="stat-card">
            <div class="stat-header">
                <span class="stat-title">Sessões Ativas</span>
                <div class="stat-icon danger">
                    <i class="fas fa-clock"></i>
                </div>
            </div>
            <div class="stat-value" id="activeSessions">-</div>
            <div class="stat-change positive">
                <i class="fas fa-arrow-up"></i>
                <span>Últimas 24h</span>
            </div>
        </div>
    </div>

    <!-- Charts -->
    <div class="charts-grid">
        <div class="chart-card">
            <div class="chart-header">
                <h3 class="chart-title">Linha do Tempo de Acessos</h3>
            </div>
            <div class="chart-container">
                <canvas id="timelineChart"></canvas>
            </div>
        </div>

        <div class="chart-card">
            <div class="chart-header">
                <h3 class="chart-title">Dispositivos</h3>
            </div>
            <div class="chart-container">
                <canvas id="devicesChart"></canvas>
            </div>
        </div>
    </div>

    <!-- Sessions Timeline -->
    <div class="sessions-container">
        <div class="sessions-header">
            <h3 class="chart-title">Linha do Tempo de Sessões</h3>
            <div class="session-search">
                <input type="text" id="userSearch" class="search-input" placeholder="Buscar por usuário...">
                <button id="searchBtn" class="refresh-btn">
                    <i class="fas fa-search"></i>
                    Buscar
                </button>
            </div>
        </div>
        
        <div id="sessionTimeline" class="session-timeline">
            <div class="loading">
                <div class="spinner"></div>
                Carregando sessões...
            </div>
        </div>
    </div>
</div>

<script src="{{ url_for('analytics.static', filename='analytics/dashboard.js') }}"></script>
{% endblock %}
