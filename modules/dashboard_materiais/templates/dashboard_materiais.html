{% extends "base.html" %}

{% block title %}Dashboard de Materiais - Portal UniSystem{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{{ url_for('dashboard_materiais.static', filename='css/materiais.css') }}">
<link rel="stylesheet" href="{{ url_for('static', filename='shared/process_modal.css') }}">
{% endblock %}

{% block content %}
<div class="dashboard-container">
    <!-- Loading Overlay -->
    <div id="loading-overlay" class="loading-overlay">
        <div class="loading-spinner">
            <div class="spinner"></div>
            <p>Carregando dados...</p>
        </div>
    </div>

    <!-- Actions Bar with Breadcrumb -->
    <div class="actions-bar">
        <div class="actions-left">
            {{ breadcrumb([
                {'name': 'Menu', 'icon': 'mdi mdi-menu', 'url': url_for('menu.menu_home')},
                {'name': 'Dashboards', 'icon': 'mdi mdi-view-dashboard', 'url': url_for('menu.dashboards')},
                {'name': 'Dashboard de Materiais', 'icon': 'mdi mdi-package-variant-closed'}
            ]) }}
        </div>
        <div class="actions-right">
            <button id="open-filters" class="btn btn-primary">
                <i class="mdi mdi-filter"></i>
                Filtros
            </button>
        </div>
    </div>
    
    <!-- KPI Cards -->
    <div class="kpi-grid">
        <div class="kpi-card">
            <div class="kpi-value" id="mat-total-processos">-</div>
            <div class="kpi-label">Total de Processos</div>
        </div>
        <div class="kpi-card">
            <div class="kpi-value" id="mat-total-materiais">-</div>
            <div class="kpi-label">Tipos de Materiais</div>
        </div>
        <div class="kpi-card">
            <div class="kpi-value" id="mat-valor-total">-</div>
            <div class="kpi-label">Valor Total CIF (R$)</div>
        </div>
        <div class="kpi-card">
            <div class="kpi-value" id="mat-custo-total">-</div>
            <div class="kpi-label">Custo Total (R$)</div>
        </div>
        <div class="kpi-card">
            <div class="kpi-value" id="mat-ticket-medio">-</div>
            <div class="kpi-label">Ticket M√©dio (R$)</div>
        </div>
        <div class="kpi-card">
            <div class="kpi-value" id="mat-transit-time">-</div>
            <div class="kpi-label">Transit Time M√©dio</div>
        </div>
        <div class="kpi-card">
            <div class="kpi-value" id="mat-processos-mes">-</div>
            <div class="kpi-label">Chegando Este M√™s</div>
            <div class="kpi-sub-value" id="mat-custo-mes">-</div>
        </div>
        <div class="kpi-card">
            <div class="kpi-value" id="mat-processos-semana">-</div>
            <div class="kpi-label">Chegando Esta Semana</div>
            <div class="kpi-sub-value" id="mat-custo-semana">-</div>
        </div>
    </div>
    
    <!-- Charts Grid -->
    <div class="charts-grid">
        <!-- Top Materiais Chart -->
        <div class="chart-section">
            <div class="chart-header">
                <h2 class="chart-title">Top 10 Materiais por Quantidade</h2>
            </div>
            <div class="chart-container">
                <canvas id="top-materiais-chart" class="chart-canvas"></canvas>
            </div>
        </div>
        
        <!-- Evolu√ß√£o Mensal Chart -->
        <div class="chart-section">
            <div class="chart-header">
                <h2 class="chart-title">Evolu√ß√£o Mensal - Top 3 Materiais</h2>
            </div>
            <div class="chart-container">
                <canvas id="evolucao-mensal-chart" class="chart-canvas"></canvas>
            </div>
        </div>
        
        <!-- Modal Distribution Chart -->
        <div class="chart-section">
            <div class="chart-header">
                <h2 class="chart-title">Distribui√ß√£o por Modal</h2>
            </div>
            <div class="chart-container">
                <canvas id="modal-chart" class="chart-canvas"></canvas>
            </div>
        </div>
        
        <!-- Canal Distribution Chart -->
        <div class="chart-section">
            <div class="chart-header">
                <h2 class="chart-title">Distribui√ß√£o por Canal</h2>
            </div>
            <div class="chart-container">
                <canvas id="canal-chart" class="chart-canvas"></canvas>
            </div>
        </div>
        
        <!-- Transit Time por Material Chart -->
        <div class="chart-section">
            <div class="chart-header">
                <h2 class="chart-title">Transit Time por Material</h2>
            </div>
            <div class="chart-container">
                <canvas id="transit-time-chart" class="chart-canvas"></canvas>
            </div>
        </div>
        
        <!-- Principais Materiais Table -->
        <div class="chart-section">
            <div class="chart-header">
                <h2 class="chart-title">Principais Materiais</h2>
            </div>
            <div class="table-container">
                <table id="principais-materiais-table" class="data-table">
                    <thead>
                        <tr>
                            <th>Material</th>
                            <th>Qtd Processos</th>
                            <th>Custo Total (R$)</th>
                            <th>Pr√≥xima Chegada</th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- Dados carregados dinamicamente -->
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- Filter Modal -->
    <div id="filter-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">üîç Filtros de Materiais</h2>
                <span class="close" id="close-modal">&times;</span>
            </div>
            <div class="modal-body">
                <!-- Filtros de Data -->
                <div class="filter-section">
                    <h4 class="filter-section-title">üìÖ Per√≠odo</h4>
                    <div class="filter-row">
                        <div class="filter-group">
                            <label for="data-inicio">Data In√≠cio:</label>
                            <input type="date" id="data-inicio" name="data_inicio" class="filter-input">
                        </div>
                        <div class="filter-group">
                            <label for="data-fim">Data Fim:</label>
                            <input type="date" id="data-fim" name="data_fim" class="filter-input">
                        </div>
                    </div>
                    
                    <!-- Filtros R√°pidos -->
                    <div class="quick-filters">
                        <span class="quick-filters-label">Filtros r√°pidos:</span>
                        <button type="button" class="btn btn-quick" data-period="7">7 dias</button>
                        <button type="button" class="btn btn-quick" data-period="30">30 dias</button>
                        <button type="button" class="btn btn-quick" data-period="90">90 dias</button>
                        <button type="button" class="btn btn-quick" data-period="365">1 ano</button>
                    </div>
                </div>
                
                <!-- Filtros de Busca -->
                <div class="filter-section">
                    <h4 class="filter-section-title">üîç Filtros de Busca</h4>
                    <div class="filter-row">
                        <div class="filter-group">
                            <label for="material-filter">Material:</label>
                            <select id="material-filter" name="material" class="filter-select">
                                <option value="">Todos os materiais</option>
                                <!-- Op√ß√µes carregadas dinamicamente -->
                            </select>
                        </div>
                        <div class="filter-group">
                            <label for="cliente-filter">Cliente:</label>
                            <select id="cliente-filter" name="cliente" class="filter-select">
                                <option value="">Todos os clientes</option>
                                <!-- Op√ß√µes carregadas dinamicamente -->
                            </select>
                        </div>
                    </div>
                </div>
                
                <!-- Filtros de Log√≠stica -->
                <div class="filter-section">
                    <h4 class="filter-section-title">üöö Log√≠stica</h4>
                    <div class="filter-row">
                        <div class="filter-group">
                            <label for="modal-filter">Modal:</label>
                            <select id="modal-filter" name="modal" class="filter-select">
                                <option value="">Todos os modais</option>
                                <option value="A√âREA">‚úàÔ∏è A√©reo</option>
                                <option value="MAR√çTIMA">üö¢ Mar√≠timo</option>
                                <option value="TERRESTRE">üöõ Terrestre</option>
                            </select>
                        </div>
                        <div class="filter-group">
                            <label for="canal-filter">Canal:</label>
                            <select id="canal-filter" name="canal" class="filter-select">
                                <option value="">Todos os canais</option>
                                <!-- Op√ß√µes carregadas dinamicamente -->
                            </select>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button id="clear-filters" class="btn btn-outline">Limpar Filtros</button>
                <button id="apply-filters" class="btn btn-primary">Aplicar Filtros</button>
            </div>
        </div>
    </div>

    <!-- Tabela de Detalhamento -->
    <div class="table-section">
        <div class="table-header">
            <h2 class="table-title">Detalhamento dos Processos</h2>
            <div class="table-controls">
                <button id="export-data" class="btn btn-secondary">üìä Exportar</button>
            </div>
        </div>
        <div class="table-container">
            <table id="detalhamento-table" class="data-table">
                <thead>
                    <tr>
                        <th>A√ß√µes</th>
                        <th>Data Abertura</th>
                        <th>N√∫mero Pedido</th>
                        <th>Cliente</th>
                        <th>Material</th>
                        <th>Data Embarque</th>
                        <th>Data Chegada</th>
                        <th>Status</th>
                        <th>Canal</th>
                        <th>Valor (R$)</th>
                    </tr>
                </thead>
                <tbody>
                    <!-- Dados carregados dinamicamente -->
                </tbody>
            </table>
        </div>
    </div>

    <!-- Modal de Detalhes do Processo -->
    {% include 'shared/process_modal.html' %}

</div>
{% endblock %}

{% block extra_js %}
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns"></script>
<script src="{{ url_for('static', filename='shared/process_modal.js') }}"></script>
<script src="{{ url_for('dashboard_materiais.static', filename='js/materiais.js') }}"></script>
{% endblock %}
