{% extends "base.html" %}

{% block title %}Dashboard Executivo Financeiro - Portal UniSystem{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{{ url_for('fin_dashboard_executivo.static', filename='css/dashboard_executivo.css') }}">
<link rel="stylesheet" href="{{ url_for('static', filename='css/kpi-cards.css') }}">
<link rel="stylesheet" href="{{ url_for('static', filename='shared/process_modal.css') }}">
<link rel="stylesheet" href="{{ url_for('shared.static', filename='css/enhanced-table.css') }}">
{% endblock %}

{% block content %}
<div class="dashboard-executivo-container">
    <!-- Actions Bar with Breadcrumb -->
    <div class="actions-bar module-header-financeiro">
        <div class="actions-left">
            {{ get_breadcrumb_with_module_colors([
                {'name': 'Menu', 'icon': 'mdi mdi-menu', 'url': url_for('menu.menu_home')},
                {'name': 'Financeiro', 'icon': 'mdi mdi-chart-line'},
                {'name': 'Dashboard Executivo', 'icon': 'mdi mdi-chart-line'}
            ], 'financeiro') }}
        </div>
    </div>
    
    <!-- Loading Overlay -->
    <div id="loading-overlay" class="loading-overlay" style="display: none;">
        <div class="loading-spinner">
            <div class="spinner"></div>
            <p class="last-update">Carregando dados do dashboard executivo...</p>
        </div>
    </div>
    
    <!-- Filter Section -->
    <div class="filter-section">
        <div class="filter-row">
            <div class="filter-group">
                <label for="year-filter">Ano</label>
                <select id="year-filter" class="form-select">
                    {% for year in range(2020, 2030) %}
                    <option value="{{ year }}" {% if loop.index == 6 %}selected{% endif %}>{{ year }}</option>
                    {% endfor %}
                </select>
            </div>
            <div class="filter-actions">
                <button id="refresh-data" class="btn btn-primary">
                    <i class="mdi mdi-refresh"></i>
                    Atualizar Dados
                </button>
            </div>
        </div>
    </div>
    
    <!-- KPI Cards -->
    <div class="kpi-grid">
        <!-- Resultado Líquido -->
        <div class="kpi-card kpi-info" id="kpi-resultado">
            <div class="kpi-content">
                <p class="kpi-label">Resultado Líquido</p>
                <p class="kpi-value" id="valor-resultado">-</p>
                <p class="kpi-variation" id="var-resultado">-</p>
            </div>
            <a href="{{ url_for('fin_fluxo_de_caixa.index') }}" class="nav-button">
                <i class="mdi mdi-arrow-right"></i>
                Ver detalhes
            </a>
        </div>
        
        <!-- Faturamento Total -->
        <div class="kpi-card kpi-success" id="kpi-faturamento">
            <div class="kpi-content">
                <p class="kpi-label">Faturamento Total</p>
                <p class="kpi-value" id="valor-faturamento">-</p>
                <p class="kpi-variation" id="var-faturamento">-</p>
            </div>
            <a href="{{ url_for('fin_faturamento.index') }}" class="nav-button">
                <i class="mdi mdi-arrow-right"></i>
                Ver detalhes
            </a>
        </div>
        
        <!-- Despesas Totais -->
        <div class="kpi-card kpi-danger" id="kpi-despesas">
            <div class="kpi-content">
                <p class="kpi-label">Despesas Totais</p>
                <p class="kpi-value" id="valor-despesas">-</p>
                <p class="kpi-variation" id="var-despesas">-</p>
            </div>
            <a href="{{ url_for('fin_despesas.index') }}" class="nav-button">
                <i class="mdi mdi-arrow-right"></i>
                Ver detalhes
            </a>
        </div>
        
        <!-- Saldo de Caixa Acumulado -->
        <div class="kpi-card kpi-primary" id="kpi-saldo-acumulado">
            <div class="kpi-content">
                <p class="kpi-label">Saldo de Caixa Acumulado</p>
                <p class="kpi-value" id="valor-saldo-acumulado">-</p>
                <p class="kpi-variation" id="var-saldo-acumulado">-</p>
            </div>
            <a href="{{ url_for('fin_fluxo_de_caixa.index') }}" class="nav-button">
                <i class="mdi mdi-arrow-right"></i>
                Ver detalhes
            </a>
        </div>
        
        <!-- Progresso da Meta Anual -->
        <div class="kpi-card kpi-warning" id="kpi-meta-progresso">
            <div class="kpi-content">
                <p class="kpi-label">Progresso da Meta Anual</p>
                <p class="kpi-value" id="valor-meta-progresso">-</p>
                <p class="kpi-variation" id="var-meta-progresso">-</p>
            </div>
        </div>
        
        <!-- Margem Líquida -->
        <div class="kpi-card kpi-purple" id="kpi-margem-liquida">
            <div class="kpi-content">
                <p class="kpi-label">Margem Líquida</p>
                <p class="kpi-value" id="valor-margem-liquida">-</p>
                <p class="kpi-variation" id="var-margem-liquida">-</p>
            </div>
        </div>
    </div>
    
    <!-- Charts Grid -->
    <div class="charts-grid">
        <!-- Resultado Mensal (60%) -->
        <div class="chart-container large-chart">
            <div class="chart-header">
                <h3 class="chart-title">
                    <i class="mdi mdi-chart-bar"></i>
                    Resultado Mensal
                </h3>
            </div>
            <div class="chart-content">
                <canvas id="chart-resultado-mensal"></canvas>
            </div>
        </div>
        
        <!-- Proporção do Faturamento (40%) -->
        <div class="chart-container small-chart">
            <div class="chart-header">
                <h3 class="chart-title">
                    <i class="mdi mdi-chart-donut"></i>
                    Proporção do Faturamento
                </h3>
                <div id="drill-down-back" style="display: none;">
                    <button id="back-to-sectors" class="nav-button">
                        <i class="mdi mdi-arrow-left"></i>
                        Voltar para Setores
                    </button>
                </div>
            </div>
            <div class="chart-content">
                <canvas id="chart-faturamento-setor"></canvas>
            </div>
        </div>
        
        <!-- Evolução do Saldo Acumulado (40%) -->
        <div class="chart-container medium-chart">
            <div class="chart-header">
                <h3 class="chart-title">
                    <i class="mdi mdi-chart-line"></i>
                    Evolução do Saldo Acumulado
                </h3>
            </div>
            <div class="chart-content">
                <canvas id="chart-saldo-acumulado"></canvas>
            </div>
        </div>
        
        <!-- Top 5 Categorias de Despesa (40%) -->
        <div class="chart-container medium-chart">
            <div class="chart-header">
                <h3 class="chart-title">
                    <i class="mdi mdi-chart-bar"></i>
                    Top 5 Categorias de Despesa
                </h3>
            </div>
            <div class="chart-content">
                <canvas id="chart-top-despesas"></canvas>
            </div>
        </div>
        
        <!-- Top 5 Clientes por Faturamento (20%) -->
        <div class="chart-container small-table">
            <div class="chart-header">
                <h3 class="chart-title">
                    <i class="mdi mdi-account-multiple"></i>
                    Top 10 Clientes
                </h3>
            </div>
            <div class="chart-content">
                <div class="table-responsive">
                    <table id="table-clientes" class="dashboard-table">
                        <thead>
                            <tr>
                                <th>#</th>
                                <th>Cliente</th>
                                <th>Faturamento</th>
                                <th>%</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- Dados carregados via JavaScript -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<!-- Add Chart.js Data Labels Plugin -->
<script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.0.0"></script>
<script src="{{ url_for('fin_dashboard_executivo.static', filename='js/dashboard_executivo.js') }}"></script>
{% endblock %}