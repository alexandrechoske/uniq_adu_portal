create table public.fin_conciliacao_movimentos (
  id bigint generated by default as identity not null,
  data_lancamento date not null,
  nome_banco text null,
  numero_conta text null,
  tipo_lancamento public.tipo_lancamento null,
  valor numeric(15, 2) null,
  descricao text null,
  ref_unique text null,
  status public.status_conciliacao not null default 'PENDENTE'::status_conciliacao,
  id_conciliacao uuid null,
  data_extracao timestamp with time zone not null default now(),
  id_usuario_conciliou uuid null,
  data_conciliacao timestamp with time zone null,
  constraint fin_conciliacao_movimentos_pkey primary key (id),
  constraint fin_conciliacao_movimentos_id_usuario_conciliou_fkey foreign KEY (id_usuario_conciliou) references auth.users (id)
) TABLESPACE pg_default;

create index IF not exists idx_conciliacao_data_lancamento on public.fin_conciliacao_movimentos using btree (data_lancamento) TABLESPACE pg_default;

create index IF not exists idx_conciliacao_status on public.fin_conciliacao_movimentos using btree (status) TABLESPACE pg_default;

create index IF not exists idx_conciliacao_ref_unique on public.fin_conciliacao_movimentos using btree (ref_unique) TABLESPACE pg_default;


INSERT INTO "public"."fin_conciliacao_movimentos" ("id", "data_lancamento", "nome_banco", "numero_conta", "tipo_lancamento", "valor", "descricao", "ref_unique", "status", "id_conciliacao", "data_extracao", "id_usuario_conciliou", "data_conciliacao") VALUES ('24024', '2025-09-25', 'ITAU', '988800', 'DESPESA', '35449.45', 'Secretaria da Fazenda Estadual - UN25/6866-1 - ICMS Importação', '195455', 'PENDENTE', null, '2025-09-24 19:36:29.803499+00', null, null), ('24025', '2025-09-24', 'ITAU', '988800', 'DESPESA', '150000.00', 'TRANSFERIDO PARA CONTA 38436-4 - TRANSFERENCIA DE SALDO', '197430', 'PENDENTE', null, '2025-09-24 19:36:29.803499+00', null, null), ('24026', '2025-09-24', 'ITAU', '988800', 'DESPESA', '110000.00', 'TRANSFERIDO PARA CONTA 38436-4 - TRANSFERENCIA DE SALDO', '197439', 'PENDENTE', null, '2025-09-24 19:36:29.803499+00', null, null), ('24027', '2025-09-24', 'ITAU', '988800', 'DESPESA', '250.00', 'Sindaesc - UN25/6412-1 - S.D.A', '197438', 'PENDENTE', null, '2025-09-24 19:36:29.803499+00', null, null), ('24028', '2025-09-24', 'ITAU', '988800', 'DESPESA', '128.92', 'PAC LOG - UN25/7005-1 - ARMAZENAGEM', '197456', 'PENDENTE', null, '2025-09-24 19:36:29.803499+00', null, null), ('24029', '2025-09-24', 'ITAU', '988800', 'DESPESA', '215.03', 'PAC LOG - UN25/7005-1 - ARMAZENAGEM', '197457', 'PENDENTE', null, '2025-09-24 19:36:29.803499+00', null, null), ('24030', '2025-09-24', 'ITAU', '988800', 'DESPESA', '2018.00', 'MSC - UN25/6110-1 - FRETE INTERNACIONAL', '197495', 'PENDENTE', null, '2025-09-24 19:36:29.803499+00', null, null), ('24031', '2025-09-24', 'ITAU', '988800', 'DESPESA', '53.01', 'FLORIPA AIRPORT - UN25/7188-1 - ARMAZENAGEM', '197453', 'PENDENTE', null, '2025-09-24 19:36:29.803499+00', null, null), ('24032', '2025-09-24', 'ITAU', '988800', 'DESPESA', '28745.75', 'Schenker - UN25/6583-1 - FRETE INTERNACIONAL', '197450', 'PENDENTE', null, '2025-09-24 19:36:29.803499+00', null, null), ('24033', '2025-09-24', 'ITAU', '988800', 'DESPESA', '28194.82', 'Schenker - UN25/6584-1 - FRETE INTERNACIONAL', '197451', 'PENDENTE', null, '2025-09-24 19:36:29.803499+00', null, null), ('24034', '2025-09-24', 'ITAU', '988800', 'DESPESA', '30874.74', 'Schenker - UN25/6585-1 - FRETE INTERNACIONAL', '197452', 'PENDENTE', null, '2025-09-24 19:36:29.803499+00', null, null), ('24035', '2025-09-24', 'ITAU', '988800', 'DESPESA', '55868.30', 'Schenker - UN25/6579-1 - FRETE INTERNACIONAL', '197468', 'PENDENTE', null, '2025-09-24 19:36:29.803499+00', null, null), ('24036', '2025-09-24', 'ITAU', '988800', 'DESPESA', '243553.94', 'ES logistics  - UN25/6638-1 - FRETE INTERNACIONAL', '197467', 'PENDENTE', null, '2025-09-24 19:36:29.803499+00', null, null), ('24037', '2025-09-24', 'ITAU', '988800', 'DESPESA', '10677.01', 'TEX SHIPPING LTDA - UN25/6827-1 - FRETE INTERNACIONAL', '197472', 'PENDENTE', null, '2025-09-24 19:36:29.803499+00', null, null), ('24038', '2025-09-24', 'ITAU', '988800', 'DESPESA', '24888.37', 'Schenker do Brasil - UN25/6639-1 - FRETE INTERNACIONAL', '197454', 'PENDENTE', null, '2025-09-24 19:36:29.803499+00', null, null), ('24039', '2025-09-24', 'ITAU', '988800', 'DESPESA', '33712.04', 'Schenker do Brasil - UN25/6891-1 - FRETE INTERNACIONAL', '197455', 'PENDENTE', null, '2025-09-24 19:36:29.803499+00', null, null), ('24040', '2025-09-24', 'ITAU', '988800', 'DESPESA', '13299.52', 'ITAPOA TERMINAIS PORTUARIOS - UN25/7050-1 - ARMAZENAGEM', '197465', 'PENDENTE', null, '2025-09-24 19:36:29.803499+00', null, null), ('24041', '2025-09-24', 'ITAU', '988800', 'DESPESA', '1261.35', 'Brazil Air & Sea Shipment - UN25/7122-1 - FRETE INTERNACIONAL', '197422', 'PENDENTE', null, '2025-09-24 19:36:29.803499+00', null, null), ('24042', '2025-09-24', 'ITAU', '988800', 'DESPESA', '1578.72', 'NEXOFOUR - UN25/7019-1 - Credito de fatura - Fatura terminou positiva.', '197424', 'PENDENTE', null, '2025-09-24 19:36:29.803499+00', null, null), ('24043', '2025-09-24', 'ITAU', '988800', 'DESPESA', '111200.78', 'PALMEIRA  - UN25/7057-1 - Credito de fatura - Fatura terminou positiva.', '197466', 'PENDENTE', null, '2025-09-24 19:36:29.803499+00', null, null), ('24044', '2025-09-24', 'ITAU', '988800', 'DESPESA', '1723.38', 'PORTONAVE S/A TERMINAIS PORTUARIOS DE NAVEGANTES - UN25/6623-1 - ARMAZENAGEM', '197471', 'PENDENTE', null, '2025-09-24 19:36:29.803499+00', null, null), ('24045', '2025-09-24', 'ITAU', '988800', 'DESPESA', '12029.07', 'MOCDROL HIDRAULICA LTDA - UN25/6709-1 - Credito de fatura - Fatura terminou positiva.', '197423', 'PENDENTE', null, '2025-09-24 19:36:29.803499+00', null, null), ('24046', '2025-09-24', 'ITAU', '988800', 'DESPESA', '437.24', 'TGP Brasil Projetos & Transportes Internacionais LTDA - UN25/7237-1 - FRETE INTERNACIONAL', '197461', 'PENDENTE', null, '2025-09-24 19:36:29.803499+00', null, null), ('24047', '2025-09-24', 'ITAU', '988800', 'DESPESA', '5699.38', 'TGP Brasil Projetos & Transportes Internacionais LTDA - UN25/7237-1 - FRETE INTERNACIONAL', '197462', 'PENDENTE', null, '2025-09-24 19:36:29.803499+00', null, null), ('24048', '2025-09-24', 'ITAU', '988800', 'DESPESA', '5699.38', 'TGP Brasil Projetos & Transportes Internacionais LTDA - UN25/7188-1 - FRETE INTERNACIONAL', '197469', 'PENDENTE', null, '2025-09-24 19:36:29.803499+00', null, null), ('24049', '2025-09-24', 'ITAU', '988800', 'DESPESA', '437.24', 'TGP Brasil Projetos & Transportes Internacionais LTDA - UN25/7188-1 - FRETE INTERNACIONAL', '197470', 'PENDENTE', null, '2025-09-24 19:36:29.803499+00', null, null), ('24050', '2025-09-24', 'ITAU', '988800', 'DESPESA', '11950.78', 'TGP Brasil Projetos & Transportes Internacionais LTDA - UN25/7194-1 - FRETE INTERNACIONAL', '197463', 'PENDENTE', null, '2025-09-24 19:36:29.803499+00', null, null), ('24051', '2025-09-24', 'ITAU', '988800', 'DESPESA', '437.24', 'TGP Brasil Projetos & Transportes Internacionais LTDA - UN25/7194-1 - FRETE INTERNACIONAL', '197464', 'PENDENTE', null, '2025-09-24 19:36:29.803499+00', null, null), ('24052', '2025-09-24', 'ITAU', '988800', 'DESPESA', '437.24', 'TGP Brasil Projetos & Transportes Internacionais LTDA - UN25/7195-1 - FRETE INTERNACIONAL', '197459', 'PENDENTE', null, '2025-09-24 19:36:29.803499+00', null, null), ('24053', '2025-09-24', 'ITAU', '988800', 'DESPESA', '5825.61', 'TGP Brasil Projetos & Transportes Internacionais LTDA - UN25/7195-1 - FRETE INTERNACIONAL', '197460', 'PENDENTE', null, '2025-09-24 19:36:29.803499+00', null, null), ('24054', '2025-09-24', 'ITAU', '98923-8', 'DESPESA', '50000.00', 'TRANSFERIDO PARA CONTA 57131-8 - TRANSFERENCIA DE SALDO', '197441', 'PENDENTE', null, '2025-09-24 19:36:29.803499+00', null, null), ('24055', '2025-09-24', 'ITAU', '98923-8', 'DESPESA', '91.06', 'Infraero - US25/0045-1 - ARMAZENAGEM', '197494', 'PENDENTE', null, '2025-09-24 19:36:29.803499+00', null, null), ('24056', '2025-09-24', 'ITAU', '98923-8', 'DESPESA', '150.00', 'CARLOS ALBERTO DE LIMA - PREPOSTO - PREPOSTO - US25.0034-FALCON - ', '197487', 'PENDENTE', null, '2025-09-24 19:36:29.803499+00', null, null), ('24057', '2025-09-24', 'ITAU', '98923-8', 'DESPESA', '150.00', 'CARLOS ALBERTO DE LIMA - PREPOSTO - PREPOSTO - US25.0013- FALCON - ', '197486', 'PENDENTE', null, '2025-09-24 19:36:29.803499+00', null, null), ('24058', '2025-09-24', 'ITAU', '98923-8', 'DESPESA', '150.00', 'CARLOS ALBERTO DE LIMA - PREPOSTO - PREPOSTO - FALCON - US25.0038 - ', '197485', 'PENDENTE', null, '2025-09-24 19:36:29.803499+00', null, null), ('24059', '2025-09-24', 'ITAU', '98923-8', 'DESPESA', '150.00', 'CARLOS ALBERTO DE LIMA - PREPOSTO - PREPOSTO - US25.0035 - FALCON - ', '197488', 'PENDENTE', null, '2025-09-24 19:36:29.803499+00', null, null), ('24060', '2025-09-24', 'SANTANDER', '13006244', 'DESPESA', '49.90', 'Cacau Show - CHOCOLATE NOVOS COLABORADORES - ', '197449', 'PENDENTE', null, '2025-09-24 19:36:29.803499+00', null, null), ('24061', '2025-09-24', 'SANTANDER', '13006244', 'DESPESA', '289.56', 'Fornecedores Diversos - TAXA DO ALVARA - DUX - ', '197448', 'PENDENTE', null, '2025-09-24 19:36:29.803499+00', null, null), ('24062', '2025-09-24', 'SANTANDER', '13006244', 'DESPESA', '440.00', 'Fornecedores Diversos - PRESENTE VIDA EVERSON - CLIENTE BRINOVAR - ', '197497', 'PENDENTE', null, '2025-09-24 19:36:29.803499+00', null, null), ('24063', '2025-09-24', 'BANCO DO BRASIL', '571318', 'DESPESA', '20.00', 'Marinha Mercante do Brasil - UN25/6597-1 - AFRMM Importação', '197427', 'PENDENTE', null, '2025-09-24 19:36:29.803499+00', null, null), ('24064', '2025-09-24', 'BANCO DO BRASIL', '57131-8', 'RECEITA', '50000.00', 'TRANSFERIDO DA CONTA 98923-8 - TRANSFERENCIA DE SALDO', '197442', 'PENDENTE', null, '2025-09-24 19:36:29.803499+00', null, null), ('24065', '2025-09-24', 'Banco do Brasil', '38436-4', 'RECEITA', '150000.00', 'TRANSFERIDO DA CONTA 988800 - TRANSFERENCIA DE SALDO', '197431', 'PENDENTE', null, '2025-09-24 19:36:29.803499+00', null, null);

---

# ANÁLISE DOS ARQUIVOS BANCÁRIOS - ESQUEMA DE COLUNAS
**Atualizado em: 24/09/2025 18:30:00**

## 📋 RESUMO DA ANÁLISE DOS 3 ARQUIVOS

### 🏦 BANCO DO BRASIL
- **Arquivo:** Banco do Brasil.xlsx
- **Tipo:** Excel (.xlsx)
- **Total de registros:** 182 (após limpeza de cabeçalhos)
- **Estrutura:** Arquivo complexo com múltiplas linhas de cabeçalho

**Mapeamento de Colunas:**
- `data`: Coluna 0 (primeira coluna) - Formato DD/MM/AAAA
- `descricao`: Coluna 7 (histórico) - Descrição da transação
- `valor`: Coluna 8 (valor R$) - Valor com vírgula como decimal
- `tipo`: Coluna 9 (C/D) - C = Crédito, D = Débito

**Exemplo de dados:**
```
29/08/2025 | Saldo Anterior            | 111.047,45  | C
01/09/2025 | TED-Crédito em Conta      | 2.300,00   | C
01/09/2025 | TED-Crédito em Conta      | 10.000,00  | C
```

### 🏦 BANCO ITAÚ
- **Arquivo:** Banco Itau.txt
- **Tipo:** Text (.txt) com separador ";"
- **Total de registros:** 137
- **Estrutura:** Formato simples com 3 colunas

**Mapeamento de Colunas:**
- `data`: Coluna 1 - Formato DD/MM/AAAA
- `descricao`: Coluna 2 - Descrição da transação (contém códigos UN25.XXXX)
- `valor`: Coluna 3 - Valor com vírgula, negativos indicam débito

**Exemplo de dados:**
```
11/09/2025 | SISPAG UN25.7020    | -533,41
11/09/2025 | PIX ENVIADO UN25.6917 | -260,00
11/09/2025 | SISPAG UN25.6269    | -17027,76
```

### 🏦 BANCO SANTANDER
- **Arquivo:** Banco Santander.xlsx
- **Tipo:** Excel (.xlsx)
- **Total de registros:** 8 (após limpeza)
- **Estrutura:** Excel com colunas mal nomeadas

**Mapeamento de Colunas:**
- `data`: Coluna 0 (AGENCIA) - Formato DD/MM/AAAA
- `descricao`: Coluna 1 (4390) - Histórico da transação
- `documento`: Coluna 2 (CONTA) - Número do documento
- `valor`: Coluna 3 (130062442) - Valor com ponto decimal
- `saldo`: Coluna 4 (Unnamed: 4) - Saldo da conta

**Exemplo de dados:**
```
04/09/2025 | APLICACAO CONTAMAX                    | -129189.8 | 0
04/09/2025 | PAGAMENTO DE BOLETO OUTROS BANCOS     | -670.2    | nan
04/09/2025 | PIX RECEBIDO  21598910000198         | 130000    | nan
```

## 🔄 PLANO DE PADRONIZAÇÃO

### Formato JSON Padrão
```json
{
  "banco": "NOME_DO_BANCO",
  "conta": "NUMERO_DA_CONTA", 
  "data_processamento": "2025-09-24T18:30:00Z",
  "movimentos": [
    {
      "data": "2025-09-24",
      "data_original": "24/09/2025",
      "descricao": "DESCRIÇÃO DO MOVIMENTO",
      "valor": 1234.56,
      "valor_original": "1.234,56",
      "tipo": "CREDITO|DEBITO",
      "codigo_referencia": "UN25/1234-1",
      "documento": "123456789"
    }
  ]
}
```

### Transformações Necessárias

**BANCO DO BRASIL:**
- Data: DD/MM/AAAA → YYYY-MM-DD
- Valor: "1.234,56" → 1234.56 
- Tipo: C/D → CREDITO/DEBITO
- Código: Extrair padrão UN\d{2}/\d{4}-\d da descrição

**BANCO ITAÚ:**
- Data: DD/MM/AAAA → YYYY-MM-DD
- Valor: "-1234,56" → 1234.56 (+ tipo DEBITO)
- Tipo: Sinal do valor → CREDITO/DEBITO
- Código: Extrair padrão UN\d{2}.\d{4} da descrição

**BANCO SANTANDER:**
- Data: DD/MM/AAAA → YYYY-MM-DD  
- Valor: "-1234.56" → 1234.56 (+ tipo DEBITO)
- Tipo: Sinal do valor → CREDITO/DEBITO
- Código: Extrair padrão UN\d{2}/\d{4}-\d da descrição

## 🎯 CAMPOS PARA CONCILIAÇÃO

**Campos principais (obrigatórios):**
- `data_lancamento`: Data exata do movimento
- `valor`: Valor exato (tolerância ±R$ 0,01) 
- `nome_banco`: Nome do banco

**Campos auxiliares (opcionais):**
- `codigo_referencia`: Código UN25/XXXX-X extraído da descrição
- `descricao`: Texto descritivo para confirmação manual
- `numero_conta`: Conta bancária


