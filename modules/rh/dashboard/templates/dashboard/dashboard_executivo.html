{% extends "base.html" %}

{% block title %}Dashboard Executivo RH - Portal UniSystem{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{{ url_for('static', filename='rh/css/rh-theme.css') }}?v=1.0">
<link rel="stylesheet" href="{{ url_for('dashboard_rh.static', filename='dashboard/dashboard_executivo.css') }}?v=2.1">
<link rel="stylesheet" href="{{ url_for('static', filename='css/kpi-cards.css') }}">
<link rel="stylesheet" href="{{ url_for('static', filename='rh/css/rh-tables.css') }}?v=3.6">
<link rel="stylesheet" href="{{ url_for('shared.static', filename='css/enhanced-table.css') }}">
{% endblock %}

{% block content %}
<div class="dashboard-executivo-container">
    <!-- Actions Bar with Breadcrumb -->
    <div class="actions-bar module-header-rh">
        <div class="actions-left">
            {{ get_breadcrumb_with_module_colors([
                {'name': 'Menu', 'icon': 'mdi mdi-menu', 'url': url_for('menu.menu_home')},
                {'name': 'Recursos Humanos', 'icon': 'mdi mdi-account-group'},
                {'name': 'Dashboard Executivo', 'icon': 'mdi mdi-chart-box-multiple-outline'}
            ], 'rh') }}
        </div>
    </div>
    
    <!-- Loading Overlay -->
    <div id="loading-overlay" class="loading-overlay" style="display: none;">
        <div class="loading-spinner">
            <div class="spinner"></div>
            <p class="last-update">Carregando dados do dashboard executivo...</p>
        </div>
    </div>
    
    <!-- Filter Section - Filtros Globais Inteligentes -->
    <div class="filter-section">
        <div class="filter-row">
            <div class="filter-group">
                <label for="periodo-filter">
                    <i class="mdi mdi-calendar-range"></i>
                    Período
                </label>
                <select id="periodo-filter" class="form-select">
                    <option value="este_ano" selected>Este Ano</option>
                    <option value="este_mes">Este Mês</option>
                    <option value="ultimos_12_meses">Últimos 12 Meses</option>
                    <option value="ano_anterior">Ano Anterior</option>
                    <option value="trimestre_atual">Trimestre Atual</option>
                    <option value="personalizado">Personalizado...</option>
                </select>
            </div>
            
            <div class="filter-group" id="custom-date-group" style="display: none;">
                <label for="data-inicio">Data Início</label>
                <input type="date" id="data-inicio" class="form-control">
            </div>
            
            <div class="filter-group" id="custom-date-end-group" style="display: none;">
                <label for="data-fim">Data Fim</label>
                <input type="date" id="data-fim" class="form-control">
            </div>
            
            <div class="filter-group">
                <label for="empresa-filter">
                    <i class="mdi mdi-domain"></i>
                    Empresa
                </label>
                <select id="empresa-filter" class="form-select">
                    <option value="todas" selected>Todas as Empresas</option>
                    <!-- Opções carregadas dinamicamente -->
                </select>
            </div>
            
            <div class="filter-group">
                <label for="departamento-filter">
                    <i class="mdi mdi-office-building"></i>
                    Departamento
                </label>
                <select id="departamento-filter" class="form-select">
                    <option value="todos" selected>Todos os Departamentos</option>
                    {% if dados.departamentos %}
                        {% for dept in dados.departamentos %}
                            <option value="{{ dept.id }}">{{ dept.nome_departamento }}</option>
                        {% endfor %}
                    {% endif %}
                </select>
            </div>
            
            <div class="filter-actions">
                <button id="refresh-data" class="btn btn-primary" onclick="atualizarDashboard()">
                    <i class="mdi mdi-refresh"></i>
                    Atualizar Dados
                </button>
                <button id="reset-filters" class="btn btn-secondary" style="display: none;" onclick="limparFiltros()">
                    <i class="mdi mdi-filter-off"></i>
                    Limpar Filtros
                </button>
            </div>
        </div>
        
        <!-- Resumo dos Filtros Aplicados -->
        <div class="filter-summary" id="filter-summary" style="display: none;">
            <span class="filter-summary-label">
                <i class="mdi mdi-filter"></i>
                Filtros aplicados:
            </span>
            <span id="filter-summary-text"></span>
        </div>
    </div>
    
    <!-- KPI Cards Principais - Seção 1: At-a-Glance -->
    <div class="kpi-section">
        <div class="kpi-grid-executive">
            <!-- KPI 1: Headcount Ativo -->
            <div class="kpi-card-compact">
                <div class="kpi-icon-container" style="background: rgba(111, 66, 193, 0.15);">
                    <i class="mdi mdi-account-group" style="color: #6f42c1; font-size: 24px;"></i>
                </div>
                <div class="kpi-metrics-container">
                    <div class="kpi-title">Total de Colaboradores</div>
                    <div class="kpi-value" id="kpi-headcount-valor">-</div>
                    <div class="kpi-comparison positive" id="kpi-headcount-variacao" style="display: none;">
                        ↑ 0%
                    </div>
                </div>
            </div>
            
            <!-- KPI 2: Custo Salários (Folha) -->
            <div class="kpi-card-compact">
                <div class="kpi-icon-container" style="background: rgba(40, 167, 69, 0.15);">
                    <i class="mdi mdi-currency-usd" style="color: #28a745; font-size: 24px;"></i>
                </div>
                <div class="kpi-metrics-container">
                    <div class="kpi-title">Custo Salários (Folha)</div>
                    <div class="kpi-value" id="kpi-custo-salarios-valor">-</div>
                    <div class="kpi-comparison neutral" id="kpi-custo-salarios-variacao" style="display: none;">
                        → 0%
                    </div>
                </div>
            </div>
            
            <!-- KPI 3: Custo Benefícios -->
            <div class="kpi-card-compact">
                <div class="kpi-icon-container" style="background: rgba(23, 162, 184, 0.15);">
                    <i class="mdi mdi-gift" style="color: #17a2b8; font-size: 24px;"></i>
                </div>
                <div class="kpi-metrics-container">
                    <div class="kpi-title">Custo Benefícios</div>
                    <div class="kpi-value" id="kpi-custo-beneficios-valor">-</div>
                    <div class="kpi-comparison neutral" id="kpi-custo-beneficios-variacao" style="display: none;">
                        → 0%
                    </div>
                </div>
            </div>
            
            <!-- KPI 4: Custo Total (Pessoal) -->
            <div class="kpi-card-compact">
                <div class="kpi-icon-container" style="background: rgba(253, 126, 20, 0.15);">
                    <i class="mdi mdi-cash-multiple" style="color: #fd7e14; font-size: 24px;"></i>
                </div>
                <div class="kpi-metrics-container">
                    <div class="kpi-title">Custo Total (Pessoal)</div>
                    <div class="kpi-value" id="kpi-custo-total-valor">-</div>
                    <div class="kpi-comparison neutral" id="kpi-custo-total-variacao" style="display: none;">
                        → 0%
                    </div>
                </div>
            </div>
            
            <!-- KPI 5: Turnover -->
            <div class="kpi-card-compact">
                <div class="kpi-icon-container" style="background: rgba(220, 53, 69, 0.15);">
                    <i class="mdi mdi-account-switch" style="color: #dc3545; font-size: 24px;"></i>
                </div>
                <div class="kpi-metrics-container">
                    <div class="kpi-title">Taxa de Rotatividade</div>
                    <div class="kpi-value" id="kpi-turnover-valor">-</div>
                    <div class="kpi-comparison negative" id="kpi-turnover-variacao" style="display: none;">
                        ↓ 0%
                    </div>
                </div>
            </div>
            
            <!-- KPI 6: Tempo Médio de Contratação -->
            <div class="kpi-card-compact">
                <div class="kpi-icon-container" style="background: rgba(23, 162, 184, 0.15);">
                    <i class="mdi mdi-clock-outline" style="color: #17a2b8; font-size: 24px;"></i>
                </div>
                <div class="kpi-metrics-container">
                    <div class="kpi-title">Tempo Médio de Contratação</div>
                    <div class="kpi-value" id="kpi-tempo-contratacao-valor">-</div>
                    <div class="kpi-comparison positive" id="kpi-tempo-contratacao-variacao" style="display: none;">
                        ↑ 0%
                    </div>
                </div>
            </div>
            
            <!-- KPI 7: Total de Vagas em Aberto -->
            <div class="kpi-card-compact">
                <div class="kpi-icon-container" style="background: rgba(255, 193, 7, 0.15);">
                    <i class="mdi mdi-briefcase-search" style="color: #ffc107; font-size: 24px;"></i>
                </div>
                <div class="kpi-metrics-container">
                    <div class="kpi-title">Vagas em Aberto</div>
                    <div class="kpi-value" id="kpi-vagas-abertas-valor">-</div>
                    <div class="kpi-comparison neutral" id="kpi-vagas-abertas-variacao" style="display: none;">
                        → 0%
                    </div>
                </div>
            </div>
            
            <!-- KPI 8: Média Candidatos por Vaga -->
            <div class="kpi-card-compact">
                <div class="kpi-icon-container" style="background: rgba(13, 110, 253, 0.15);">
                    <i class="mdi mdi-account-multiple-outline" style="color: #0d6efd; font-size: 24px;"></i>
                </div>
                <div class="kpi-metrics-container">
                    <div class="kpi-title">Média Candidatos/Vaga</div>
                    <div class="kpi-value" id="kpi-media-candidatos-valor">-</div>
                    <div class="kpi-comparison positive" id="kpi-media-candidatos-variacao" style="display: none;">
                        ↑ 0%
                    </div>
                </div>
            </div>
            
            <!-- KPI 9: Tempo Médio de Casa -->
            <div class="kpi-card-compact">
                <div class="kpi-icon-container" style="background: rgba(111, 66, 193, 0.15);">
                    <i class="mdi mdi-history" style="color: #6f42c1; font-size: 24px;"></i>
                </div>
                <div class="kpi-metrics-container">
                    <div class="kpi-title">Tempo Médio de Casa</div>
                    <div class="kpi-value" id="kpi-tempo-casa-valor">-</div>
                    <div class="kpi-comparison neutral" id="kpi-tempo-casa-variacao" style="display: none;">
                        → 0%
                    </div>
                </div>
            </div>
            
            <!-- KPI 10: Idade Média dos Colaboradores -->
            <div class="kpi-card-compact">
                <div class="kpi-icon-container" style="background: rgba(111, 66, 193, 0.15);">
                    <i class="mdi mdi-cake-variant" style="color: #6f42c1; font-size: 24px;"></i>
                </div>
                <div class="kpi-metrics-container">
                    <div class="kpi-title">Idade Média</div>
                    <div class="kpi-value" id="kpi-idade-media-valor">-</div>
                    <div class="kpi-comparison neutral" id="kpi-idade-media-variacao" style="display: none;">
                        → 0%
                    </div>
                </div>
            </div>

            <!-- KPI 11: Total de Admissões no Período -->
            <div class="kpi-card-compact">
                <div class="kpi-icon-container" style="background: rgba(40, 167, 69, 0.15);">
                    <i class="mdi mdi-account-plus" style="color: #28a745; font-size: 24px;"></i>
                </div>
                <div class="kpi-metrics-container">
                    <div class="kpi-title">Admissões</div>
                    <div class="kpi-value" id="kpi-admissoes-valor">-</div>
                    <div class="kpi-comparison neutral" id="kpi-admissoes-variacao" style="display: none;">
                        → 0%
                    </div>
                </div>
            </div>

            <!-- KPI 12: Total de Demissões no Período -->
            <div class="kpi-card-compact">
                <div class="kpi-icon-container" style="background: rgba(220, 53, 69, 0.15);">
                    <i class="mdi mdi-account-minus" style="color: #dc3545; font-size: 24px;"></i>
                </div>
                <div class="kpi-metrics-container">
                    <div class="kpi-title">Demissões</div>
                    <div class="kpi-value" id="kpi-demissoes-valor">-</div>
                    <div class="kpi-comparison neutral" id="kpi-demissoes-variacao" style="display: none;">
                        → 0%
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Charts Grid - Seção 2: Análise Detalhada -->
    <div class="dashboard-sections">
        <div class="section-title">
            <i class="mdi mdi-chart-line"></i>
            Análises Visuais e Tendências
        </div>
        
        <div class="row">
            <!-- Gráfico 1: Evolução Headcount e Turnover -->
            <div class="col-12 mb-4">
                <div class="chart-card">
                    <div class="chart-container" style="height: 350px;">
                        <canvas id="chart-evolucao-headcount"></canvas>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="row">
            <!-- Gráfico 2: Turnover por Departamento -->
            <div class="col-md-6 mb-4">
                <div class="chart-card">
                    <div class="chart-container" style="height: 450px;">
                        <canvas id="chart-turnover-departamento"></canvas>
                    </div>
                </div>
            </div>
            
            <!-- Gráfico 3: Distribuição por Departamento -->
            <div class="col-md-6 mb-4">
                <div class="chart-card">
                    <div class="chart-container" style="height: 450px;">
                        <canvas id="chart-distribuicao-departamento"></canvas>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Tabelas Detalhadas - Seção 3 -->
    <div class="tables-section">
        <div class="section-title">
            <i class="mdi mdi-table-large"></i>
            Insights e Detalhes
        </div>
        
        <div class="row">
            <!-- Tabela 1: Vagas Abertas - Análise de Performance -->
            <div class="col-12 mb-4">
                <div class="card">
                    <div class="card-header">
                        <h5 class="mb-0">
                            <i class="mdi mdi-briefcase-search"></i>
                            Visão Geral das Vagas em Aberto
                        </h5>
                    </div>
                    <div class="card-body p-0">
                        <div class="table-responsive">
                            <table class="table table-hover mb-0">
                                <thead>
                                    <tr>
                                        <th>Título da Vaga</th>
                                        <th>Departamento</th>
                                        <th>Dias em Aberto</th>
                                        <th>Custo Estimado (Salário)</th>
                                        <th class="text-center">Ações</th>
                                    </tr>
                                </thead>
                                <tbody id="tabela-vagas-tbody">
                                    <tr>
                                        <td colspan="5" class="text-center text-muted">
                                            Carregando vagas...
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.2.0/dist/chartjs-plugin-datalabels.min.js"></script>
<script src="{{ url_for('dashboard_rh.static', filename='dashboard/dashboard_executivo.js') }}?v=3.7"></script>
{% endblock %}
