{% extends "base.html" %}

{% block title %}Gestão de Vagas - RH{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{{ url_for('static', filename='rh/css/rh-theme.css') }}?v=1.0">
<link rel="stylesheet" href="{{ url_for('static', filename='rh/colaboradores/colaboradores.css') }}?v=2.4">
<link rel="stylesheet" href="{{ url_for('static', filename='css/kpi-cards.css') }}">
<link rel="stylesheet" href="{{ url_for('static', filename='rh/css/rh-tables.css') }}?v=3.6">
<style>
/* ============================================================================
   ESTILOS ESPECÍFICOS DA GESTÃO DE VAGAS - RECRUTAMENTO
   Versão: 2.0 - Com tabela Excel e Header Verde
   ============================================================================ */

/* Cores do Recrutamento (Verde) */
:root {
    --recrutamento-primary: #28a745;
    --recrutamento-primary-dark: #1e7e34;
    --recrutamento-primary-light: #5cb85c;
}

.btn-recrutamento-primary {
    background: linear-gradient(135deg, var(--recrutamento-primary) 0%, var(--recrutamento-primary-dark) 100%);
    border: none;
    color: white !important;
    font-weight: 600;
    padding: 0.75rem 1.5rem;
    border-radius: 0.5rem;
    transition: all 0.3s ease;
}

.btn-recrutamento-primary:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(40, 167, 69, 0.3);
}

.module-header-recrutamento {
    background: linear-gradient(135deg, var(--recrutamento-primary) 0%, var(--recrutamento-primary-dark) 100%);
    color: white !important;
    border-bottom: none;
}

.badge-status.aberta { background-color: #28a745; color: white; }
.badge-status.pausada { background-color: #ffc107; color: #000; }
.badge-status.fechada { background-color: #dc3545; color: white; }
.badge-status.cancelada { background-color: #6c757d; color: white; }
.badge-status { padding: 0.35rem 0.75rem; font-size: 0.8125rem; border-radius: 0.375rem; }

/* Estilos para tags de benefícios */
#beneficios_tags {
    min-height: 40px;
    padding: 0.5rem;
    border: 1px dashed #dee2e6;
    border-radius: 0.375rem;
    background-color: #f8f9fa;
}

#beneficios_tags:empty::before {
    content: 'Nenhum benefício adicionado';
    color: #6c757d;
    font-style: italic;
    font-size: 0.875rem;
}

#beneficios_tags .badge {
    animation: slideIn 0.2s ease;
}

@keyframes slideIn {
    from {
        opacity: 0;
        transform: translateX(-10px);
    }
    to {
        opacity: 1;
        transform: translateX(0);
    }
}

/* ============================================================================
   TABELA DE VAGAS - ESTILO EXCEL
   ============================================================================ */

/* Container da tabela com scroll suave */
.table-responsive {
    box-shadow: 0 2px 12px rgba(0,0,0,0.08);
    border-radius: 0.75rem;
    overflow: hidden;
}

/* Tabela base */
#tabelaVagas {
    margin-bottom: 0 !important;
    border-collapse: separate;
    border-spacing: 0;
}

/* ============================================================================
   OVERRIDE FORÇADO - FUNDO VERDE E TEXTO BRANCO NO HEADER
   Máxima especificidade para sobrescrever Bootstrap e outros CSS
   ============================================================================ */

/* FUNDO VERDE no thead - Prioridade máxima */
table#tabelaVagas > thead.rh-table-header,
#tabelaVagas > thead.rh-table-header,
#tabelaVagas thead.rh-table-header {
    background: #28a745 !important;
    background-image: linear-gradient(135deg, #28a745 0%, #1e7e34 100%) !important;
    background-color: #28a745 !important;
    color: white !important;
}

/* TEXTO BRANCO em todos os th - Prioridade máxima */
table#tabelaVagas > thead.rh-table-header > tr > th,
#tabelaVagas > thead.rh-table-header > tr > th,
#tabelaVagas > thead > tr > th,
#tabelaVagas thead th {
    color: white !important;
    background: transparent !important;
    border-color: rgba(255,255,255,0.2) !important;
}

/* Header com ordenação clicável */
#tabelaVagas thead th {
    position: relative;
    cursor: pointer;
    user-select: none;
    padding: 1rem 0.75rem;
    font-weight: 700;
    font-size: 0.8125rem;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    border-bottom: 2px solid rgba(255,255,255,0.2);
    transition: all 0.2s ease;
}

/* Cor do texto no header - BRANCO fixo */
#tabelaVagas > thead.rh-table-header > tr > th {
    color: white !important;
}

#tabelaVagas thead th:not(.sortable) {
    cursor: default;
}

#tabelaVagas thead th.sortable:hover {
    background: rgba(255,255,255,0.1);
}

#tabelaVagas thead th.sortable {
    padding-right: 2rem;
}

/* Indicador de ordenação */
#tabelaVagas thead th.sortable::after {
    content: '\F0143'; /* mdi-chevron-up */
    font-family: 'Material Design Icons';
    position: absolute;
    right: 0.5rem;
    top: 50%;
    transform: translateY(-50%);
    opacity: 0.3;
    font-size: 1.125rem;
    transition: all 0.2s ease;
}

#tabelaVagas thead th.sortable:hover::after {
    opacity: 0.6;
}

#tabelaVagas thead th.sort-asc::after {
    content: '\F0143'; /* mdi-chevron-up */
    opacity: 1;
    color: #ffc107;
}

#tabelaVagas thead th.sort-desc::after {
    content: '\F0140'; /* mdi-chevron-down */
    opacity: 1;
    color: #ffc107;
}

/* Zebramento leve (alternado) */
#tabelaVagas tbody tr:nth-child(odd) {
    background-color: #ffffff;
}

#tabelaVagas tbody tr:nth-child(even) {
    background-color: #f8f9fa;
}

/* Hover na linha */
#tabelaVagas tbody tr:hover {
    background-color: #e8f5e9 !important;
    transform: scale(1.002);
    box-shadow: 0 2px 8px rgba(40, 167, 69, 0.15);
    transition: all 0.2s ease;
}

/* Células do corpo */
#tabelaVagas tbody td {
    padding: 0.875rem 0.75rem;
    vertical-align: middle;
    border-bottom: 1px solid #e9ecef;
    transition: all 0.2s ease;
}

/* Primeira coluna (numeração) */
#tabelaVagas tbody td:first-child {
    font-weight: 600;
    color: #6c757d;
    font-size: 0.75rem;
}

/* Título da vaga */
#tabelaVagas tbody td:nth-child(2) strong {
    font-size: 0.9375rem;
    color: #2c3e50;
    transition: color 0.2s ease;
}

#tabelaVagas tbody tr:hover td:nth-child(2) strong {
    color: var(--recrutamento-primary);
}

/* Badges de status melhorados */
#tabelaVagas .badge-status {
    padding: 0.375rem 0.75rem;
    border-radius: 0.375rem;
    font-size: 0.8125rem;
    font-weight: 600;
    display: inline-flex;
    align-items: center;
    gap: 0.375rem;
}

#tabelaVagas .badge-status.aberta {
    background: #d4edda;
    color: #155724;
}

#tabelaVagas .badge-status.pausada {
    background: #fff3cd;
    color: #856404;
}

#tabelaVagas .badge-status.fechada {
    background: #f8d7da;
    color: #721c24;
}

#tabelaVagas .badge-status i {
    font-size: 0.875rem;
}

/* Badge de candidatos */
#tabelaVagas .badge.bg-info {
    background: linear-gradient(135deg, #17a2b8 0%, #138496 100%) !important;
    color: white !important;
    padding: 0.375rem 0.625rem;
    font-weight: 600;
}

/* Botões de ação */
#tabelaVagas .btn-group-sm .btn {
    padding: 0.375rem 0.625rem;
    font-size: 0.875rem;
    border-radius: 0.25rem;
    transition: all 0.2s ease;
}

#tabelaVagas .btn-outline-info {
    color: #17a2b8;
    border-color: #17a2b8;
}

#tabelaVagas .btn-outline-info:hover {
    background: #17a2b8;
    color: white;
    transform: translateY(-2px);
    box-shadow: 0 4px 8px rgba(23, 162, 184, 0.3);
}

#tabelaVagas .btn-outline-success {
    color: #28a745;
    border-color: #28a745;
}

#tabelaVagas .btn-outline-success:hover {
    background: #28a745;
    color: white;
    transform: translateY(-2px);
    box-shadow: 0 4px 8px rgba(40, 167, 69, 0.3);
}

#tabelaVagas .btn-outline-primary {
    color: #007bff;
    border-color: #007bff;
}

#tabelaVagas .btn-outline-primary:hover {
    background: #007bff;
    color: white;
    transform: translateY(-2px);
    box-shadow: 0 4px 8px rgba(0, 123, 255, 0.3);
}

/* Ícones nas células */
#tabelaVagas tbody td i.mdi {
    margin-right: 0.25rem;
    opacity: 0.7;
}

/* Estado de loading durante ordenação */
#tabelaVagas.sorting {
    opacity: 0.6;
    pointer-events: none;
}

/* Animação de ordenação */
@keyframes sortAnimation {
    0%, 100% { opacity: 1; }
    50% { opacity: 0.5; }
}

#tabelaVagas.sorting tbody {
    animation: sortAnimation 0.3s ease;
}

/* Responsividade */
@media (max-width: 1200px) {
    #tabelaVagas thead th,
    #tabelaVagas tbody td {
        padding: 0.75rem 0.5rem;
        font-size: 0.8125rem;
    }
}

@media (max-width: 768px) {
    #tabelaVagas {
        font-size: 0.75rem;
    }
    
    #tabelaVagas thead th,
    #tabelaVagas tbody td {
        padding: 0.625rem 0.375rem;
    }
    
    .btn-group-sm .btn {
        padding: 0.25rem 0.5rem;
    }
}

/* ============================================================================
   CORREÇÃO DE BOTÕES - btn-outline-secondary
   ============================================================================ */
.btn-outline-secondary {
    color: #6c757d !important;
    border-color: #6c757d !important;
    background-color: white !important;
}

.btn-outline-secondary:hover {
    color: white !important;
    background-color: #6c757d !important;
    border-color: #6c757d !important;
}

.btn-outline-secondary:active,
.btn-outline-secondary:focus {
    color: white !important;
    background-color: #5c636a !important;
    border-color: #5c636a !important;
}
</style>
{% endblock %}

{% block content %}
<div class="rh-container">
    <!-- Actions Bar -->
    <div class="actions-bar module-header-rh">
        <nav aria-label="breadcrumb">
            <ol class="breadcrumb mb-0">
                <li class="breadcrumb-item"><a href="/"><i class="mdi mdi-home-outline"></i> Início</a></li>
                <li class="breadcrumb-item"><a href="#">RH</a></li>
                <li class="breadcrumb-item active">Gestão de Vagas</li>
            </ol>
        </nav>
        <div class="actions-buttons">
            <button class="btn btn-recrutamento-primary" data-bs-toggle="modal" data-bs-target="#modalVaga" onclick="abrirModalNovaVaga()">
                <i class="mdi mdi-plus"></i> Nova Vaga
            </button>
        </div>
    </div>

    <!-- KPI Cards -->
    <div class="kpi-section">
        <div class="kpi-group">
            <h5 class="kpi-group-title">
                <i class="mdi mdi-chart-box-outline"></i>
                Resumo Geral
            </h5>
            <div class="kpi-grid-rh" style="grid-template-columns: repeat(4, 1fr);">
                <div class="kpi-card kpi-success">
                    <div class="kpi-icon">
                        <i class="mdi mdi-briefcase-search"></i>
                    </div>
                    <div class="kpi-content">
                        <p class="kpi-label">Total de Vagas</p>
                        <p class="kpi-value">{{ total_vagas }}</p>
                    </div>
                </div>
                
                <div class="kpi-card kpi-success">
                    <div class="kpi-icon">
                        <i class="mdi mdi-briefcase-check"></i>
                    </div>
                    <div class="kpi-content">
                        <p class="kpi-label">Vagas Abertas</p>
                        <p class="kpi-value">{{ vagas_abertas }}</p>
                    </div>
                </div>
                
                <div class="kpi-card kpi-danger">
                    <div class="kpi-icon">
                        <i class="mdi mdi-briefcase-remove"></i>
                    </div>
                    <div class="kpi-content">
                        <p class="kpi-label">Vagas Fechadas</p>
                        <p class="kpi-value">{{ vagas_fechadas }}</p>
                    </div>
                </div>
                
                <div class="kpi-card kpi-primary">
                    <div class="kpi-icon">
                        <i class="mdi mdi-account-multiple"></i>
                    </div>
                    <div class="kpi-content">
                        <p class="kpi-label">Média Candidatos/Vaga</p>
                        <p class="kpi-value">{{ candidatos_media }}</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Barra de Busca e Filtros -->
    <div class="card rh-card mb-4">
        <div class="card-body">
            <div class="row g-3">
                <!-- Busca por título -->
                <div class="col-md-3">
                    <div class="input-group">
                        <span class="input-group-text bg-white border-end-0">
                            <i class="mdi mdi-magnify text-muted"></i>
                        </span>
                        <input type="text" id="searchVaga" class="form-control border-start-0" 
                               placeholder="Buscar por título..." 
                               onkeyup="filtrarTabelaVagas()">
                    </div>
                </div>
                
                <!-- Filtro Status -->
                <div class="col-md-2">
                    <select id="filterStatus" class="form-select" onchange="filtrarTabelaVagas()">
                        <option value="">Status: Todos</option>
                        <option value="aberta">Aberta</option>
                        <option value="pausada">Pausada</option>
                        <option value="fechada">Fechada</option>
                    </select>
                </div>
                
                <!-- Filtro Tipo de Contratação -->
                <div class="col-md-2">
                    <select id="filterTipo" class="form-select" onchange="filtrarTabelaVagas()">
                        <option value="">Tipo: Todos</option>
                        <option value="CLT">CLT</option>
                        <option value="PJ">PJ</option>
                        <option value="Estágio">Estágio</option>
                    </select>
                </div>
                
                <!-- Filtro Nível -->
                <div class="col-md-2">
                    <select id="filterNivel" class="form-select" onchange="filtrarTabelaVagas()">
                        <option value="">Nível: Todos</option>
                        <option value="Estágio">Estágio</option>
                        <option value="Júnior">Júnior</option>
                        <option value="Pleno">Pleno</option>
                        <option value="Sênior">Sênior</option>
                        <option value="Especialista">Especialista</option>
                        <option value="Liderança">Liderança</option>
                    </select>
                </div>
                
                <!-- Filtro Regime -->
                <div class="col-md-2">
                    <select id="filterRegime" class="form-select" onchange="filtrarTabelaVagas()">
                        <option value="">Regime: Todos</option>
                        <option value="Presencial">Presencial</option>
                        <option value="Híbrido">Híbrido</option>
                        <option value="Remoto">Remoto</option>
                    </select>
                </div>
                
                <!-- Botão Limpar -->
                <div class="col-md-1">
                    <button class="btn btn-outline-secondary w-100" onclick="limparFiltrosVagas()" 
                            data-bs-toggle="tooltip" title="Limpar filtros">
                        <i class="mdi mdi-eraser"></i>
                    </button>
                </div>
            </div>
            
            <!-- Segunda linha: Data e Localização -->
            <div class="row g-3 mt-2">
                <!-- Filtro Localização -->
                <div class="col-md-3">
                    <select id="filterLocalizacao" class="form-select" onchange="filtrarTabelaVagas()">
                        <option value="">Localização: Todas</option>
                    </select>
                </div>
                
                <!-- Filtro Data Início -->
                <div class="col-md-2">
                    <input type="date" id="filterDataInicio" class="form-control" 
                           placeholder="Data Início" onchange="filtrarTabelaVagas()">
                </div>
                
                <!-- Filtro Data Fim -->
                <div class="col-md-2">
                    <input type="date" id="filterDataFim" class="form-control" 
                           placeholder="Data Fim" onchange="filtrarTabelaVagas()">
                </div>
                
                <!-- Contador de resultados -->
                <div class="col-md-5 text-end d-flex align-items-center justify-content-end">
                    <small class="text-muted">
                        <i class="mdi mdi-information-outline"></i>
                        <span id="filtroResultados">Exibindo todas as vagas</span>
                    </small>
                </div>
            </div>
        </div>
    </div>

    <!-- Tabela de Vagas -->
    <div class="card rh-card">
        <div class="card-body p-0">
            {% if vagas|length > 0 %}
            <div class="table-responsive">
                <table class="table mb-0" id="tabelaVagas">
                    <thead class="rh-table-header" style="background: linear-gradient(135deg, #28a745 0%, #1e7e34 100%) !important; color: white !important;">
                        <tr>
                            <th style="width: 3%; color: white !important;" class="text-center">#</th>
                            <th style="width: 25%; color: white !important;" class="sortable" data-column="titulo" data-type="text">
                                Título da Vaga
                            </th>
                            <th style="width: 10%; color: white !important;" class="sortable" data-column="status" data-type="text">
                                Status
                            </th>
                            <th style="width: 8%; color: white !important;" class="text-center sortable" data-column="candidatos" data-type="number">
                                Candidatos
                            </th>
                            <th style="width: 10%; color: white !important;" class="sortable" data-column="data" data-type="date">
                                Data Abertura
                            </th>
                            <th style="width: 12%; color: white !important;" class="sortable" data-column="localizacao" data-type="text">
                                Localização
                            </th>
                            <th style="width: 17%; color: white !important;" class="sortable" data-column="tipo" data-type="text">
                                Tipo Contratação
                            </th>
                            <th style="width: 15%; color: white !important;" class="text-center">Ações</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for vaga in vagas %}
                        <tr data-titulo="{{ vaga.titulo }}" 
                            data-status="{{ vaga.status|lower }}"
                            data-data="{{ vaga.data_abertura[:10] if vaga.data_abertura else '' }}"
                            data-localizacao="{{ vaga.localizacao|lower if vaga.localizacao else '' }}"
                            data-tipo="{{ vaga.tipo_contratacao|lower if vaga.tipo_contratacao else 'clt' }}"
                            data-nivel="{{ vaga.nivel_senioridade|lower if vaga.nivel_senioridade else '' }}"
                            data-regime="{{ vaga.regime_trabalho|lower if vaga.regime_trabalho else '' }}">
                            <td class="text-muted small">{{ loop.index }}</td>
                            <td>
                                <strong class="text-dark">{{ vaga.titulo }}</strong>
                            </td>
                            <td>
                                {% if vaga.status == 'Aberta' %}
                                <span class="badge badge-status aberta">
                                    <i class="mdi mdi-circle"></i> Aberta
                                </span>
                                {% elif vaga.status == 'Pausada' %}
                                <span class="badge badge-status pausada">
                                    <i class="mdi mdi-pause-circle"></i> Pausada
                                </span>
                                {% elif vaga.status == 'Cancelada' %}
                                <span class="badge badge-status cancelada">
                                    <i class="mdi mdi-cancel"></i> Cancelada
                                </span>
                                {% else %}
                                <span class="badge badge-status fechada">
                                    <i class="mdi mdi-close-circle"></i> Fechada
                                </span>
                                {% endif %}
                            </td>
                            <td class="text-center">
                                <span class="badge bg-info text-dark" style="font-size: 0.875rem;">
                                    <i class="mdi mdi-account-multiple"></i> {{ vaga.total_candidatos }}
                                </span>
                            </td>
                            <td>
                                <small class="text-muted">
                                    <i class="mdi mdi-calendar"></i>
                                    {% if vaga.data_abertura %}
                                        {% set data_parts = vaga.data_abertura[:10].split('-') %}
                                        {{ data_parts[2] }}/{{ data_parts[1] }}/{{ data_parts[0] }}
                                    {% else %}
                                        N/A
                                    {% endif %}
                                </small>
                            </td>
                            <td>
                                <small class="text-muted">{{ vaga.localizacao or 'Não informado' }}</small>
                            </td>
                            <td>
                                <small class="text-muted">
                                    <i class="mdi mdi-briefcase-outline"></i> {{ vaga.tipo_contratacao or 'CLT' }}
                                </small>
                            </td>
                            <td class="text-center">
                                <div class="btn-group btn-group-sm" role="group">
                                    <!-- Botão Visualizar -->
                                    <button class="btn btn-outline-info" 
                                            onclick="visualizarVaga('{{ vaga.id }}')" 
                                            data-bs-toggle="tooltip"
                                            title="Visualizar detalhes">
                                        <i class="mdi mdi-eye"></i>
                                    </button>
                                    
                                    <!-- Botão Candidatos -->
                                    <a href="{{ url_for('recrutamento.gestao_candidatos', vaga_id=vaga.id) }}"
                                       class="btn btn-outline-success"
                                       data-bs-toggle="tooltip"
                                       title="Gerenciar candidatos">
                                        <i class="mdi mdi-account-multiple"></i>
                                    </a>
                                    
                                    <!-- Botão Editar -->
                                    <button class="btn btn-outline-primary" 
                                            onclick="editarVaga('{{ vaga.id }}')" 
                                            data-bs-toggle="tooltip"
                                            title="Editar">
                                        <i class="mdi mdi-pencil"></i>
                                    </button>

                                    {% if vaga.status == 'Aberta' or vaga.status == 'Pausada' %}
                                    <!-- Botão Desativar -->
                                    <button class="btn btn-outline-danger"
                                            onclick="desativarVaga('{{ vaga.id }}')"
                                            data-bs-toggle="tooltip"
                                            title="Desativar vaga">
                                        <i class="mdi mdi-power"></i>
                                    </button>
                                    {% else %}
                                    <!-- Botão Ativar -->
                                    <button class="btn btn-outline-secondary"
                                            onclick="ativarVaga('{{ vaga.id }}')"
                                            data-bs-toggle="tooltip"
                                            title="Ativar vaga">
                                        <i class="mdi mdi-refresh"></i>
                                    </button>
                                    {% endif %}
                                </div>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
            {% else %}
            <div class="empty-state">
                <i class="mdi mdi-briefcase-search" style="font-size: 4rem; color: #28a745; opacity: 0.3;"></i>
                <h5>Nenhuma vaga cadastrada</h5>
                <p>Clique em "Nova Vaga" para adicionar a primeira vaga</p>
            </div>
            {% endif %}
        </div>
    </div>

</div> <!-- Fecha rh-container -->

<!-- Modal de Vaga (Criar/Editar) -->
<div class="modal fade" id="modalVaga" tabindex="-1" aria-labelledby="modalVagaLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header" style="background: linear-gradient(135deg, #28a745 0%, #1e7e34 100%); color: white;">
                <h5 class="modal-title" id="modalVagaLabel">Nova Vaga</h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form id="formVaga">
                    <input type="hidden" id="vaga_id" name="vaga_id">
                    
                    <div class="row g-3">
                        <!-- Título -->
                        <div class="col-md-8">
                            <label for="titulo" class="form-label">
                                Título da Vaga <span class="text-danger">*</span>
                            </label>
                            <input type="text" class="form-control" id="titulo" name="titulo" 
                                   placeholder="Ex: Analista de Importação Pleno" required>
                        </div>
                        
                        <!-- Tipo de Contratação -->
                        <div class="col-md-4">
                            <label for="tipo_contratacao" class="form-label">Tipo de Contratação</label>
                            <select class="form-select" id="tipo_contratacao" name="tipo_contratacao">
                                <option value="CLT" selected>CLT</option>
                                <option value="PJ">PJ</option>
                                <option value="Estágio">Estágio</option>
                            </select>
                        </div>
                        
                        <!-- Cargo Oficial -->
                        <div class="col-md-6">
                            <label for="cargo_id" class="form-label">
                                Cargo Oficial <span class="text-danger">*</span>
                            </label>
                            <select class="form-select" id="cargo_id" name="cargo_id" required>
                                <option value="">Selecione um cargo...</option>
                                {% if cargos %}
                                    {% for cargo in cargos %}
                                    <option value="{{ cargo.id }}">{{ cargo.nome_cargo }}</option>
                                    {% endfor %}
                                {% else %}
                                    <option disabled>⚠️ Nenhum cargo cadastrado</option>
                                {% endif %}
                            </select>
                            <small class="text-muted">
                                {{ cargos|length if cargos else 0 }} cargo(s) disponível(is)
                            </small>
                        </div>
                        
                        <!-- Localização -->
                        <div class="col-md-6">
                            <label for="localizacao" class="form-label">Localização</label>
                            <input type="text" class="form-control" id="localizacao" name="localizacao" 
                                   placeholder="Ex: Joinville - SC / Remoto">
                        </div>
                        
                        <!-- NOVOS CAMPOS: Remuneração e Benefícios -->
                        <div class="col-12">
                            <hr class="my-3">
                            <h6 class="mb-3">
                                <i class="mdi mdi-currency-usd"></i> Remuneração e Benefícios
                            </h6>
                            <div class="alert alert-info mb-3">
                                <i class="mdi mdi-information-outline"></i>
                                <strong>Informação:</strong> Os dados de remuneração e benefícios são <strong>apenas para controle interno</strong> 
                                e <strong>não são exibidos</strong> no portal de carreiras público.
                            </div>
                        </div>
                        
                        <div class="col-md-6">
                            <label for="faixa_salarial_min" class="form-label">
                                <i class="mdi mdi-currency-usd"></i> Faixa Salarial Mínima
                            </label>
                            <input type="number" step="0.01" class="form-control" id="faixa_salarial_min" 
                                   name="faixa_salarial_min" placeholder="Ex: 3000.00">
                        </div>
                        
                        <div class="col-md-6">
                            <label for="faixa_salarial_max" class="form-label">
                                <i class="mdi mdi-currency-usd"></i> Faixa Salarial Máxima
                            </label>
                            <input type="number" step="0.01" class="form-control" id="faixa_salarial_max" 
                                   name="faixa_salarial_max" placeholder="Ex: 5000.00">
                        </div>
                        
                        <div class="col-12">
                            <label for="beneficios_input" class="form-label">
                                <i class="mdi mdi-gift"></i> Benefícios
                            </label>
                            <input type="text" class="form-control" id="beneficios_input" 
                                   placeholder="Digite um benefício e pressione Enter">
                            <div id="beneficios_tags" class="mt-2 d-flex flex-wrap gap-2"></div>
                            <input type="hidden" id="beneficios" name="beneficios">
                            <small class="text-muted">
                                Ex: Vale Transporte, Vale Refeição, Plano de Saúde, etc.
                            </small>
                        </div>
                        
                        <!-- NOVOS CAMPOS: Detalhes da Vaga -->
                        <div class="col-12">
                            <hr class="my-3">
                            <h6 class="mb-3">
                                <i class="mdi mdi-information-outline"></i> Detalhes da Vaga
                            </h6>
                        </div>
                        
                        <div class="col-md-4">
                            <label for="nivel_senioridade" class="form-label">
                                <i class="mdi mdi-star-outline"></i> Nível de Senioridade
                            </label>
                            <select class="form-select" id="nivel_senioridade" name="nivel_senioridade">
                                <option value="">Selecione...</option>
                                <option value="Estágio">Estágio</option>
                                <option value="Júnior">Júnior</option>
                                <option value="Pleno">Pleno</option>
                                <option value="Sênior">Sênior</option>
                                <option value="Especialista">Especialista</option>
                                <option value="Liderança">Liderança</option>
                            </select>
                        </div>
                        
                        <div class="col-md-4">
                            <label for="regime_trabalho" class="form-label">
                                <i class="mdi mdi-home-city-outline"></i> Regime de Trabalho
                            </label>
                            <select class="form-select" id="regime_trabalho" name="regime_trabalho">
                                <option value="">Selecione...</option>
                                <option value="Presencial">Presencial</option>
                                <option value="Híbrido">Híbrido</option>
                                <option value="Remoto">Remoto</option>
                            </select>
                        </div>
                        
                        <div class="col-md-4">
                            <label for="quantidade_vagas" class="form-label">
                                <i class="mdi mdi-account-multiple"></i> Quantidade de Vagas
                            </label>
                            <input type="number" class="form-control" id="quantidade_vagas" 
                                   name="quantidade_vagas" value="1" min="1">
                        </div>
                        
                        <div class="col-md-6">
                            <label for="carga_horaria" class="form-label">
                                <i class="mdi mdi-clock-outline"></i> Carga Horária
                            </label>
                            <input type="text" class="form-control" id="carga_horaria" 
                                   name="carga_horaria" placeholder="Ex: 40h/semana, 44h/semana">
                        </div>
                        
                        <!-- NOVOS CAMPOS: Requisitos Detalhados -->
                        <div class="col-12">
                            <hr class="my-3">
                            <h6 class="mb-3">
                                <i class="mdi mdi-clipboard-check-outline"></i> Requisitos Detalhados
                            </h6>
                        </div>
                        
                        <!-- Descrição da Vaga -->
                        <div class="col-12">
                            <label for="descricao" class="form-label">
                                Descrição da Vaga <span class="text-danger">*</span>
                            </label>
                            <textarea class="form-control" id="descricao" name="descricao" 
                                      rows="4" placeholder="Detalhe as responsabilidades da posição..." required></textarea>
                        </div>
                        
                        <!-- Requisitos Obrigatórios -->
                        <div class="col-12">
                            <label for="requisitos_obrigatorios" class="form-label">
                                Requisitos Obrigatórios <span class="text-danger">*</span>
                            </label>
                            <textarea class="form-control" id="requisitos_obrigatorios" name="requisitos_obrigatorios" 
                                      rows="3" placeholder="Liste os requisitos essenciais para a vaga..." required></textarea>
                        </div>
                        
                        <!-- Requisitos Desejáveis -->
                        <div class="col-12">
                            <label for="requisitos_desejaveis" class="form-label">
                                Requisitos Desejáveis
                            </label>
                            <textarea class="form-control" id="requisitos_desejaveis" name="requisitos_desejaveis" 
                                      rows="3" placeholder="Liste os requisitos opcionais mas valorizados..."></textarea>
                        </div>
                        
                        <!-- Diferenciais -->
                        <div class="col-12">
                            <label for="diferenciais" class="form-label">
                                Diferenciais
                            </label>
                            <textarea class="form-control" id="diferenciais" name="diferenciais" 
                                      rows="2" placeholder="Conhecimentos que são diferenciais competitivos..."></textarea>
                        </div>
                        
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                    <i class="mdi mdi-close"></i> Cancelar
                </button>
                <button type="button" class="btn btn-recrutamento-primary" onclick="salvarVaga()">
                    <i class="mdi mdi-content-save"></i> Salvar Vaga
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Modal de Confirmação de Exclusão -->
<div class="modal fade" id="modalConfirmarExclusao" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header bg-danger text-white">
                <h5 class="modal-title">
                    <i class="mdi mdi-alert"></i> Confirmar Exclusão
                </h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <p>Tem certeza que deseja excluir a vaga:</p>
                <p class="fw-bold" id="vagaNomeExcluir"></p>
                <p class="text-danger">
                    <i class="mdi mdi-alert-circle"></i> Esta ação não pode ser desfeita.
                </p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                <button type="button" class="btn btn-danger" id="btnConfirmarExclusao">
                    <i class="mdi mdi-delete"></i> Confirmar Exclusão
                </button>
            </div>
        </div>
    </div>
</div>

{% endblock %}

{% block extra_js %}
<script src="{{ url_for('recrutamento.static', filename='recrutamento/recrutamento.js') }}?v=4"></script>
<script>
// Inicializar tooltips
document.addEventListener('DOMContentLoaded', function() {
    // Inicializar tooltips Bootstrap
    var tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'));
    var tooltipList = tooltipTriggerList.map(function (tooltipTriggerEl) {
        return new bootstrap.Tooltip(tooltipTriggerEl);
    });
    
    // Popular filtro de localização dinamicamente
    popularFiltroLocalizacao();
    
    // Event listener para input de benefícios (Enter para adicionar)
    const beneficiosInput = document.getElementById('beneficios_input');
    if (beneficiosInput) {
        beneficiosInput.addEventListener('keydown', function(e) {
            if (e.key === 'Enter') {
                e.preventDefault();
                adicionarBeneficio(this.value);
            }
        });
        
        // Autocomplete simples para benefícios
        beneficiosInput.addEventListener('input', function(e) {
            const valor = this.value.toLowerCase();
            if (valor.length >= 2) {
                const sugestoes = beneficiosComuns.filter(b => 
                    b.toLowerCase().includes(valor) && !beneficiosArray.includes(b)
                );
                
                // Exibir primeira sugestão como hint
                if (sugestoes.length > 0) {
                    this.setAttribute('placeholder', `Pressione Enter para adicionar: ${sugestoes[0]}`);
                }
            }
        });
    }
});

// Função para popular o filtro de localização com valores únicos da tabela
function popularFiltroLocalizacao() {
    const table = document.getElementById('tabelaVagas');
    if (!table) return;
    
    const rows = table.getElementsByTagName('tbody')[0].getElementsByTagName('tr');
    const localizacoes = new Set();
    
    for (let row of rows) {
        if (row.classList.contains('empty-state')) continue;
        const loc = row.getAttribute('data-localizacao');
        if (loc && loc.trim()) {
            localizacoes.add(loc.trim());
        }
    }
    
    // Ordenar alfabeticamente
    const locArray = Array.from(localizacoes).sort();
    
    // Popular o select
    const select = document.getElementById('filterLocalizacao');
    if (select && locArray.length > 0) {
        // Limpar opções existentes (exceto a primeira)
        select.innerHTML = '<option value="">Localização: Todas</option>';
        
        // Adicionar cada localização
        locArray.forEach(loc => {
            const option = document.createElement('option');
            option.value = loc;
            // Capitalizar primeira letra de cada palavra
            option.textContent = loc.split(' ').map(word => 
                word.charAt(0).toUpperCase() + word.slice(1).toLowerCase()
            ).join(' ');
            select.appendChild(option);
        });
        
        console.log('[FILTRO] Localizações carregadas:', locArray.length);
    }
}

// Função para filtrar a tabela de vagas
function filtrarTabelaVagas() {
    console.log('[FILTRO] Iniciando filtro de vagas');
    
    const searchTerm = document.getElementById('searchVaga').value.toLowerCase().trim();
    const statusFilter = document.getElementById('filterStatus').value.toLowerCase();
    const tipoFilter = document.getElementById('filterTipo').value.toLowerCase();
    const nivelFilter = document.getElementById('filterNivel').value.toLowerCase();
    const regimeFilter = document.getElementById('filterRegime').value.toLowerCase();
    const localizacaoFilter = document.getElementById('filterLocalizacao').value.toLowerCase();
    const dataInicio = document.getElementById('filterDataInicio').value;
    const dataFim = document.getElementById('filterDataFim').value;
    
    console.log('[FILTRO] Critérios:', {
        searchTerm, statusFilter, tipoFilter, nivelFilter, 
        regimeFilter, localizacaoFilter, dataInicio, dataFim
    });
    
    const table = document.getElementById('tabelaVagas');
    const rows = table.getElementsByTagName('tbody')[0].getElementsByTagName('tr');
    const filtroResultados = document.getElementById('filtroResultados');
    let visibleCount = 0;
    let totalCount = 0;
    
    // Contar linhas válidas
    for (let row of rows) {
        if (!row.classList.contains('empty-state')) totalCount++;
    }
    
    // Se não há filtros ativos, mostrar todas as linhas
    if (!searchTerm && !statusFilter && !tipoFilter && !nivelFilter && 
        !regimeFilter && !localizacaoFilter && !dataInicio && !dataFim) {
        for (let row of rows) {
            if (!row.classList.contains('empty-state')) {
                row.style.display = '';
                visibleCount++;
            }
        }
        if (filtroResultados) {
            filtroResultados.textContent = `Exibindo todas as ${totalCount} vagas`;
        }
        console.log('[FILTRO] Sem filtros ativos - mostrando todas');
        return;
    }
    
    // Filtrar cada linha
    for (let row of rows) {
        if (row.classList.contains('empty-state')) continue;
        
        const titulo = (row.getAttribute('data-titulo') || '').toLowerCase();
        const status = (row.getAttribute('data-status') || '').toLowerCase();
        const tipo = (row.getAttribute('data-tipo') || '').toLowerCase();
        const nivel = (row.getAttribute('data-nivel') || '').toLowerCase();
        const regime = (row.getAttribute('data-regime') || '').toLowerCase();
        const localizacao = (row.getAttribute('data-localizacao') || '').toLowerCase();
        const dataAbertura = row.getAttribute('data-data') || '';
        
        let show = true;
        
        // Filtro de busca (título)
        if (searchTerm && !titulo.includes(searchTerm)) {
            show = false;
        }
        
        // Filtro de status
        if (statusFilter && status !== statusFilter) {
            show = false;
        }
        
        // Filtro de tipo de contratação
        if (tipoFilter && tipo !== tipoFilter) {
            show = false;
        }
        
        // Filtro de nível de senioridade
        if (nivelFilter && nivel !== nivelFilter) {
            show = false;
        }
        
        // Filtro de regime de trabalho
        if (regimeFilter && regime !== regimeFilter) {
            show = false;
        }
        
        // Filtro de localização
        if (localizacaoFilter && !localizacao.includes(localizacaoFilter)) {
            show = false;
        }
        
        // Filtro de data início (data_abertura já está em formato ISO YYYY-MM-DD)
        if (dataInicio && dataAbertura) {
            if (dataAbertura < dataInicio) {
                show = false;
            }
        }
        
        // Filtro de data fim (data_abertura já está em formato ISO YYYY-MM-DD)
        if (dataFim && dataAbertura) {
            if (dataAbertura > dataFim) {
                show = false;
            }
        }
        
        row.style.display = show ? '' : 'none';
        if (show) visibleCount++;
    }
    
    // Atualizar contador de resultados
    if (filtroResultados) {
        if (visibleCount === 0) {
            filtroResultados.innerHTML = '<i class="mdi mdi-alert-circle text-warning"></i> Nenhuma vaga encontrada';
        } else if (visibleCount === totalCount) {
            filtroResultados.textContent = `Exibindo todas as ${totalCount} vagas`;
        } else {
            filtroResultados.textContent = `Exibindo ${visibleCount} de ${totalCount} vagas`;
        }
    }
    
    console.log('[FILTRO] Resultados visíveis:', visibleCount, 'de', totalCount);
}

// Função para limpar filtros
function limparFiltrosVagas() {
    console.log('[FILTRO] Limpando todos os filtros');
    
    document.getElementById('searchVaga').value = '';
    document.getElementById('filterStatus').value = '';
    document.getElementById('filterTipo').value = '';
    document.getElementById('filterNivel').value = '';
    document.getElementById('filterRegime').value = '';
    document.getElementById('filterLocalizacao').value = '';
    document.getElementById('filterDataInicio').value = '';
    document.getElementById('filterDataFim').value = '';
    
    filtrarTabelaVagas();
}

// Função para visualizar detalhes da vaga em modal
function visualizarVaga(vagaId) {
    console.log('[VISUALIZAR] Carregando vaga ID:', vagaId);
    
    fetch(`/rh/recrutamento/api/vagas/${vagaId}`, {
        method: 'GET',
        headers: {
            'Content-Type': 'application/json'
        }
    })
    .then(response => response.json())
    .then(data => {
        console.log('[VISUALIZAR] Response:', data);
        
        if (data.success && data.vaga) {
            const vaga = data.vaga;
            
            // Formatar data (ISO para DD/MM/YYYY)
            const formatarData = (dataISO) => {
                if (!dataISO) return '-';
                try {
                    const data = new Date(dataISO);
                    return data.toLocaleDateString('pt-BR', {
                        day: '2-digit',
                        month: '2-digit',
                        year: 'numeric'
                    });
                } catch {
                    return dataISO;
                }
            };
            
            // Formatar benefícios
            const formatarBeneficios = (beneficios) => {
                if (!beneficios) return '-';
                if (Array.isArray(beneficios)) {
                    return beneficios.map(b => `<span class="badge bg-info text-dark me-1 mb-1">${b}</span>`).join('');
                }
                return beneficios;
            };
            
            // Formatar salário
            const formatarSalario = (min, max) => {
                if (!min && !max) return '<span class="text-muted">Não informado</span>';
                if (min && max) return `R$ ${parseFloat(min).toLocaleString('pt-BR', {minimumFractionDigits: 2})} - R$ ${parseFloat(max).toLocaleString('pt-BR', {minimumFractionDigits: 2})}`;
                if (min) return `A partir de R$ ${parseFloat(min).toLocaleString('pt-BR', {minimumFractionDigits: 2})}`;
                return `Até R$ ${parseFloat(max).toLocaleString('pt-BR', {minimumFractionDigits: 2})}`;
            };
            
            // Criar modal dinamicamente com TODOS os campos
            const modalHtml = `
                <div class="modal fade" id="modalVisualizarVaga" tabindex="-1">
                    <div class="modal-dialog modal-xl">
                        <div class="modal-content">
                            <div class="modal-header" style="background: linear-gradient(135deg, #28a745 0%, #1e7e34 100%); color: white;">
                                <h5 class="modal-title">
                                    <i class="mdi mdi-briefcase-eye me-2"></i>
                                    ${vaga.titulo || 'Detalhes da Vaga'}
                                </h5>
                                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                            </div>
                            <div class="modal-body">
                                
                                <!-- Informações Gerais -->
                                <div class="card mb-3">
                                    <div class="card-header bg-light">
                                        <h6 class="mb-0"><i class="mdi mdi-information-outline me-2"></i>Informações Gerais</h6>
                                    </div>
                                    <div class="card-body">
                                        <div class="row g-3">
                                            <div class="col-md-4">
                                                <label class="form-label fw-bold text-muted small">Status</label>
                                                <p class="mb-0">
                                                    <span class="badge ${vaga.status === 'Aberta' ? 'bg-success' : vaga.status === 'Pausada' ? 'bg-warning' : 'bg-secondary'}">
                                                        <i class="mdi mdi-circle me-1"></i>${vaga.status || '-'}
                                                    </span>
                                                </p>
                                            </div>
                                            
                                            <div class="col-md-4">
                                                <label class="form-label fw-bold text-muted small">Cargo</label>
                                                <p class="mb-0">${vaga.cargo_nome || '-'}</p>
                                            </div>
                                            
                                            <div class="col-md-4">
                                                <label class="form-label fw-bold text-muted small">Total de Candidatos</label>
                                                <p class="mb-0">
                                                    <span class="badge bg-primary"><i class="mdi mdi-account-multiple me-1"></i>${vaga.total_candidatos || 0}</span>
                                                </p>
                                            </div>
                                            
                                            <div class="col-md-3">
                                                <label class="form-label fw-bold text-muted small">Data de Abertura</label>
                                                <p class="mb-0"><i class="mdi mdi-calendar text-muted me-1"></i>${formatarData(vaga.data_abertura)}</p>
                                            </div>
                                            
                                            <div class="col-md-3">
                                                <label class="form-label fw-bold text-muted small">Data de Fechamento</label>
                                                <p class="mb-0"><i class="mdi mdi-calendar-remove text-muted me-1"></i>${formatarData(vaga.data_fechamento)}</p>
                                            </div>
                                            
                                            <div class="col-md-3">
                                                <label class="form-label fw-bold text-muted small">Localização</label>
                                                <p class="mb-0"><i class="mdi mdi-map-marker text-muted me-1"></i>${vaga.localizacao || '-'}</p>
                                            </div>
                                            
                                            <div class="col-md-3">
                                                <label class="form-label fw-bold text-muted small">Tipo de Contratação</label>
                                                <p class="mb-0"><i class="mdi mdi-briefcase-outline text-muted me-1"></i>${vaga.tipo_contratacao || '-'}</p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Remuneração e Benefícios -->
                                ${vaga.faixa_salarial_min || vaga.faixa_salarial_max || vaga.beneficios ? `
                                <div class="card mb-3">
                                    <div class="card-header bg-light">
                                        <h6 class="mb-0"><i class="mdi mdi-cash-multiple me-2"></i>Remuneração e Benefícios</h6>
                                    </div>
                                    <div class="card-body">
                                        <div class="row g-3">
                                            ${vaga.faixa_salarial_min || vaga.faixa_salarial_max ? `
                                            <div class="col-md-6">
                                                <label class="form-label fw-bold text-muted small">Faixa Salarial</label>
                                                <p class="mb-0 fs-5 text-success">${formatarSalario(vaga.faixa_salarial_min, vaga.faixa_salarial_max)}</p>
                                            </div>
                                            ` : ''}
                                            
                                            ${vaga.beneficios ? `
                                            <div class="col-md-${vaga.faixa_salarial_min || vaga.faixa_salarial_max ? '6' : '12'}">
                                                <label class="form-label fw-bold text-muted small">Benefícios</label>
                                                <p class="mb-0">${formatarBeneficios(vaga.beneficios)}</p>
                                            </div>
                                            ` : ''}
                                        </div>
                                    </div>
                                </div>
                                ` : ''}
                                
                                <!-- Detalhes da Vaga -->
                                ${vaga.nivel_senioridade || vaga.regime_trabalho || vaga.carga_horaria ? `
                                <div class="card mb-3">
                                    <div class="card-header bg-light">
                                        <h6 class="mb-0"><i class="mdi mdi-cog-outline me-2"></i>Detalhes da Vaga</h6>
                                    </div>
                                    <div class="card-body">
                                        <div class="row g-3">
                                            ${vaga.nivel_senioridade ? `
                                            <div class="col-md-4">
                                                <label class="form-label fw-bold text-muted small">Nível de Senioridade</label>
                                                <p class="mb-0"><i class="mdi mdi-trending-up text-muted me-1"></i>${vaga.nivel_senioridade}</p>
                                            </div>
                                            ` : ''}
                                            
                                            ${vaga.regime_trabalho ? `
                                            <div class="col-md-4">
                                                <label class="form-label fw-bold text-muted small">Regime de Trabalho</label>
                                                <p class="mb-0"><i class="mdi mdi-laptop text-muted me-1"></i>${vaga.regime_trabalho}</p>
                                            </div>
                                            ` : ''}
                                            
                                            ${vaga.carga_horaria ? `
                                            <div class="col-md-4">
                                                <label class="form-label fw-bold text-muted small">Carga Horária</label>
                                                <p class="mb-0"><i class="mdi mdi-clock-outline text-muted me-1"></i>${vaga.carga_horaria}</p>
                                            </div>
                                            ` : ''}
                                        </div>
                                    </div>
                                </div>
                                ` : ''}
                                
                                <!-- Descrição -->
                                <div class="card mb-3">
                                    <div class="card-header bg-light">
                                        <h6 class="mb-0"><i class="mdi mdi-text-box-outline me-2"></i>Descrição da Vaga</h6>
                                    </div>
                                    <div class="card-body">
                                        <p class="mb-0" style="white-space: pre-wrap;">${vaga.descricao || '-'}</p>
                                    </div>
                                </div>
                                
                                <!-- Requisitos -->
                                <div class="card mb-0">
                                    <div class="card-header bg-light">
                                        <h6 class="mb-0"><i class="mdi mdi-check-circle-outline me-2"></i>Requisitos</h6>
                                    </div>
                                    <div class="card-body">
                                        <div class="row g-3">
                                            <div class="col-md-12">
                                                <label class="form-label fw-bold text-danger small">Requisitos Obrigatórios</label>
                                                <p class="mb-0" style="white-space: pre-wrap;">${vaga.requisitos_obrigatorios || vaga.requisitos || '-'}</p>
                                            </div>
                                            
                                            ${vaga.requisitos_desejaveis ? `
                                            <div class="col-md-12">
                                                <label class="form-label fw-bold text-warning small">Requisitos Desejáveis</label>
                                                <p class="mb-0" style="white-space: pre-wrap;">${vaga.requisitos_desejaveis}</p>
                                            </div>
                                            ` : ''}
                                            
                                            ${vaga.diferenciais ? `
                                            <div class="col-md-12">
                                                <label class="form-label fw-bold text-success small">Diferenciais</label>
                                                <p class="mb-0" style="white-space: pre-wrap;">${vaga.diferenciais}</p>
                                            </div>
                                            ` : ''}
                                        </div>
                                    </div>
                                </div>
                                
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                                    <i class="mdi mdi-close me-1"></i>Fechar
                                </button>
                                <button type="button" class="btn btn-primary" onclick="editarVaga('${vaga.id}'); bootstrap.Modal.getInstance(document.getElementById('modalVisualizarVaga')).hide();">
                                    <i class="mdi mdi-pencil me-1"></i>Editar Vaga
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            // Remover modal anterior se existir
            const oldModal = document.getElementById('modalVisualizarVaga');
            if (oldModal) {
                oldModal.remove();
            }
            
            // Adicionar novo modal ao body
            document.body.insertAdjacentHTML('beforeend', modalHtml);
            
            // Abrir modal
            const modal = new bootstrap.Modal(document.getElementById('modalVisualizarVaga'));
            modal.show();
            
            // Remover modal do DOM quando fechado
            document.getElementById('modalVisualizarVaga').addEventListener('hidden.bs.modal', function() {
                this.remove();
            });
        } else {
            alert('Erro ao carregar dados da vaga: ' + (data.message || 'Erro desconhecido'));
        }
    })
    .catch(error => {
        console.error('[VISUALIZAR] Erro:', error);
            alert('Erro ao carregar dados da vaga');
        });
}

// ============================================
// SISTEMA DE TAGS PARA BENEFÍCIOS
// ============================================
let beneficiosArray = [];

function adicionarBeneficio(beneficio) {
    beneficio = beneficio.trim();
    if (beneficio && !beneficiosArray.includes(beneficio)) {
        beneficiosArray.push(beneficio);
        renderizarBeneficios();
        document.getElementById('beneficios_input').value = '';
    }
}

function removerBeneficio(index) {
    beneficiosArray.splice(index, 1);
    renderizarBeneficios();
}

function renderizarBeneficios() {
    const container = document.getElementById('beneficios_tags');
    container.innerHTML = '';
    
    beneficiosArray.forEach((beneficio, index) => {
        const tag = document.createElement('span');
        tag.className = 'badge bg-primary d-flex align-items-center gap-1';
        tag.style.fontSize = '0.9rem';
        tag.style.padding = '0.5rem 0.75rem';
        tag.innerHTML = `
            ${beneficio}
            <i class="mdi mdi-close" style="cursor: pointer;" onclick="removerBeneficio(${index})"></i>
        `;
        container.appendChild(tag);
    });
    
    // Atualizar campo hidden com array
    document.getElementById('beneficios').value = JSON.stringify(beneficiosArray);
}

// Sugestões de benefícios comuns
const beneficiosComuns = [
    'Vale Transporte',
    'Vale Refeição',
    'Vale Alimentação',
    'Plano de Saúde',
    'Plano Odontológico',
    'Seguro de Vida',
    'Day Off de Aniversário',
    'Auxílio Home Office',
    'Gympass',
    'Convênio Farmácia'
];

// ============================================
// FUNÇÃO DE EDIÇÃO DE VAGA
// ============================================
function editarVaga(vagaId) {
    console.log('[EDITAR] Carregando vaga ID:', vagaId);
    
    fetch(`/rh/recrutamento/api/vagas/${vagaId}`, {
        method: 'GET',
        headers: {
            'Content-Type': 'application/json'
        },
        credentials: 'same-origin'
    })
    .then(response => response.json())
    .then(data => {
        if (data.success && data.vaga) {
            const vaga = data.vaga;
            console.log('[EDITAR] Vaga carregada:', vaga);
            
            // Preencher modal com dados da vaga
            document.getElementById('vaga_id').value = vaga.id;
            document.getElementById('titulo').value = vaga.titulo || '';
            document.getElementById('cargo_id').value = vaga.cargo_id || '';
            document.getElementById('tipo_contratacao').value = vaga.tipo_contratacao || 'CLT';
            document.getElementById('localizacao').value = vaga.localizacao || '';
            document.getElementById('descricao').value = vaga.descricao || '';
            
            // Campos de remuneração
            document.getElementById('faixa_salarial_min').value = vaga.faixa_salarial_min || '';
            document.getElementById('faixa_salarial_max').value = vaga.faixa_salarial_max || '';
            
            // Benefícios (array)
            beneficiosArray = [];
            if (vaga.beneficios) {
                if (Array.isArray(vaga.beneficios)) {
                    beneficiosArray = [...vaga.beneficios];
                } else if (typeof vaga.beneficios === 'string') {
                    try {
                        beneficiosArray = JSON.parse(vaga.beneficios);
                    } catch {
                        beneficiosArray = vaga.beneficios.split(',').map(b => b.trim());
                    }
                }
            }
            renderizarBeneficios();
            
            // Detalhes da vaga
            document.getElementById('nivel_senioridade').value = vaga.nivel_senioridade || '';
            document.getElementById('quantidade_vagas').value = vaga.quantidade_vagas || 1;
            document.getElementById('regime_trabalho').value = vaga.regime_trabalho || '';
            document.getElementById('carga_horaria').value = vaga.carga_horaria || '';
            
            // Requisitos detalhados
            document.getElementById('requisitos_obrigatorios').value = vaga.requisitos_obrigatorios || vaga.requisitos || '';
            document.getElementById('requisitos_desejaveis').value = vaga.requisitos_desejaveis || '';
            document.getElementById('diferenciais').value = vaga.diferenciais || '';
            
            // Atualizar título do modal
            document.getElementById('modalVagaLabel').textContent = 'Editar Vaga';
            
            // Abrir modal
            const modal = new bootstrap.Modal(document.getElementById('modalVaga'));
            modal.show();
        } else {
            alert('Erro ao carregar dados da vaga: ' + (data.message || 'Erro desconhecido'));
        }
    })
    .catch(error => {
        console.error('[EDITAR] Erro:', error);
        alert('Erro ao carregar dados da vaga');
    });
}

// Função para abrir modal de nova vaga
function abrirModalNovaVaga() {
    // Limpar formulário
    document.getElementById('formVaga').reset();
    document.getElementById('vaga_id').value = '';
    beneficiosArray = [];
    renderizarBeneficios();
    
    // Atualizar título do modal
    document.getElementById('modalVagaLabel').textContent = 'Nova Vaga';
}

// ============================================================================
// SISTEMA DE ORDENAÇÃO DE TABELA - ESTILO EXCEL
// ============================================================================

let currentSort = {
    column: null,
    direction: null // 'asc' ou 'desc'
};

/**
 * Inicializa os event listeners para ordenação
 */
function inicializarOrdenacao() {
    console.log('[SORT] Inicializando sistema de ordenação');
    
    const headers = document.querySelectorAll('#tabelaVagas thead th.sortable');
    
    headers.forEach(header => {
        header.addEventListener('click', function() {
            const column = this.dataset.column;
            const type = this.dataset.type;
            
            // Determinar direção
            let direction = 'asc';
            if (currentSort.column === column && currentSort.direction === 'asc') {
                direction = 'desc';
            }
            
            ordenarTabela(column, type, direction);
        });
    });
    
    console.log('[SORT] Sistema de ordenação inicializado');
}

/**
 * Ordena a tabela por coluna
 */
function ordenarTabela(column, type, direction) {
    console.log(`[SORT] Ordenando por ${column} (${type}) - ${direction}`);
    
    const table = document.getElementById('tabelaVagas');
    const tbody = table.querySelector('tbody');
    const rows = Array.from(tbody.querySelectorAll('tr'));
    
    // Adicionar classe de loading
    table.classList.add('sorting');
    
    // Remover classes de ordenação antigas
    const headers = table.querySelectorAll('thead th.sortable');
    headers.forEach(h => {
        h.classList.remove('sort-asc', 'sort-desc');
    });
    
    // Adicionar classe de ordenação atual
    const currentHeader = table.querySelector(`thead th[data-column="${column}"]`);
    if (currentHeader) {
        currentHeader.classList.add(direction === 'asc' ? 'sort-asc' : 'sort-desc');
    }
    
    // Filtrar linhas válidas (não vazias)
    const validRows = rows.filter(row => !row.classList.contains('empty-state'));
    
    // Ordenar linhas
    validRows.sort((a, b) => {
        let valueA, valueB;
        
        switch(column) {
            case 'titulo':
                valueA = a.dataset.titulo || '';
                valueB = b.dataset.titulo || '';
                break;
            case 'status':
                valueA = a.dataset.status || '';
                valueB = b.dataset.status || '';
                break;
            case 'candidatos':
                // Extrair número de candidatos do badge
                const badgeA = a.querySelector('.badge.bg-info');
                const badgeB = b.querySelector('.badge.bg-info');
                valueA = badgeA ? parseInt(badgeA.textContent.match(/\d+/)[0]) : 0;
                valueB = badgeB ? parseInt(badgeB.textContent.match(/\d+/)[0]) : 0;
                break;
            case 'data':
                valueA = a.dataset.data || '';
                valueB = b.dataset.data || '';
                break;
            case 'localizacao':
                valueA = a.dataset.localizacao || '';
                valueB = b.dataset.localizacao || '';
                break;
            case 'tipo':
                valueA = a.dataset.tipo || '';
                valueB = b.dataset.tipo || '';
                break;
            default:
                return 0;
        }
        
        // Comparar valores
        let comparison = 0;
        if (type === 'number') {
            comparison = valueA - valueB;
        } else if (type === 'date') {
            comparison = new Date(valueA) - new Date(valueB);
        } else {
            comparison = valueA.toString().localeCompare(valueB.toString(), 'pt-BR', { 
                sensitivity: 'base' 
            });
        }
        
        return direction === 'asc' ? comparison : -comparison;
    });
    
    // Reaplicar linhas ordenadas
    validRows.forEach(row => tbody.appendChild(row));
    
    // Renumerar linhas
    renumerarLinhas();
    
    // Atualizar estado atual
    currentSort = { column, direction };
    
    // Remover classe de loading após animação
    setTimeout(() => {
        table.classList.remove('sorting');
    }, 300);
    
    console.log(`[SORT] Ordenação concluída: ${validRows.length} linhas`);
}

/**
 * Renumera as linhas visíveis da tabela
 */
function renumerarLinhas() {
    const tbody = document.querySelector('#tabelaVagas tbody');
    const rows = tbody.querySelectorAll('tr:not(.empty-state)');
    
    let visibleIndex = 1;
    rows.forEach((row) => {
        const firstCell = row.querySelector('td:first-child');
        if (firstCell && row.style.display !== 'none') {
            firstCell.textContent = visibleIndex++;
        }
    });
}

// Chamar inicialização de ordenação no DOMContentLoaded existente
const originalDOMReady = document.readyState === 'loading' ? 
    document.addEventListener('DOMContentLoaded', function() { inicializarOrdenacao(); }) :
    inicializarOrdenacao();
</script>
{% endblock %}