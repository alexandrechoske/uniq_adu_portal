<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>UniSystem - {% block title %}{% endblock %}</title>
    <link rel="icon" type="image/png" href="{{ url_for('static', filename='medias/Logo_Unique.png') }}">    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.plot.ly/plotly-2.27.0.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/@mdi/font@7.4.47/css/materialdesignicons.min.css" rel="stylesheet"><style>
        /* Unique Aduaneira Brand Colors */
        :root {
            --color-primary: #1F406F;
            --color-secondary: #3498DB;
            --color-white: #FFFFFF;
            --color-primary-light: rgba(31, 64, 111, 0.1);
            --color-secondary-light: rgba(52, 152, 219, 0.1);
        }
          body {
            font-family: 'Inter', sans-serif;
            background-color: #f8fafc;
        }/* Top Navigation Bar - Unique Aduaneira Brand Colors */
        .top-navbar {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            height: 4rem;
            background: linear-gradient(135deg, var(--color-primary) 0%, var(--color-secondary) 100%);
            z-index: 1000;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 2px 4px rgba(31, 64, 111, 0.1);
        }
        
        .navbar-content {
            display: flex;
            align-items: center;
            justify-content: space-between;
            height: 100%;
            padding: 0 1rem;
        }
        
        .navbar-left {
            display: flex;
            align-items: center;
            gap: 1rem;
        }
          .navbar-hamburger {
            background: transparent;
            border: none;
            color: var(--color-white);
            padding: 0.5rem;
            border-radius: 0.375rem;
            transition: background-color 0.2s ease;
            cursor: pointer;
        }
        
        .navbar-hamburger:hover {
            background-color: rgba(255, 255, 255, 0.1);
        }
        
        .navbar-logo {
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }
        
        .navbar-logo img {
            height: 2rem;
            width: auto;
        }
          .navbar-title {
            color: var(--color-white);
            font-size: 1.125rem;
            font-weight: 600;
            margin: 0;
        }
        
        .navbar-right {
            display: flex;
            align-items: center;
            gap: 1rem;
        }
        
        .navbar-user-info {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            color: var(--color-white);
            font-size: 0.875rem;
        }/* Mobile responsive adjustments */
        @media (max-width: 768px) {
            .main-content {
                margin-left: 0 !important; /* Override sidebar margin on mobile */
                padding: 70px 0.5rem 0.5rem 0.5rem; /* Slightly more top padding on mobile */
            }
            
            .navbar-content {
                padding: 0 0.75rem;
            }
            
            .navbar-logo {
                gap: 0.5rem;
            }
            
            .navbar-logo img {
                height: 1.75rem;
            }
            
            .navbar-title {
                font-size: 1rem;
            }
        }

        /* Sidebar adjustments for top navbar */
        .sidebar-icon {
            width: 1.5rem;
            height: 1.5rem;
            flex-shrink: 0;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .sidebar-icon svg {
            width: 1.5rem;
            height: 1.5rem;
        }        /* Main content area adjustments - Optimized spacing */
        .main-content {
            margin-left: 16rem; /* w-64 equivalent when sidebar expanded */
            transition: margin-left 0.3s ease;
            padding: 60px 0.75rem 0.75rem 0.75rem; /* Top padding to clear fixed header */
            min-height: calc(100vh - 4rem); /* Full height minus header */
            background-color: #f8fafc; /* Match body background */
            position: relative; /* Ensure proper positioning context */
        }
        
        .main-content.sidebar-collapsed {
            margin-left: 4rem; /* w-16 equivalent when sidebar collapsed */
        }

        /* Content wrapper to eliminate any potential spacing issues */
        .content-wrapper {
            background: white;
            border-radius: 0.5rem;
            box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }/* Ensure icons render properly on all devices */
        svg {
            display: block;
            max-width: 100%;
            height: auto;
        }
        
        .sidebar-item {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.75rem 1rem;
            color: #374151;
            border-radius: 0.5rem;
            transition-property: background-color, border-color, color, fill, stroke;
            transition-timing-function: cubic-bezier(0.4, 0, 0.2, 1);
            transition-duration: 200ms;
        }
        .sidebar-item:hover {
            background-color: #f3f4f6;
        }          /* Active sidebar item - Using brand colors */
        .sidebar-item.active {
            background-color: var(--color-secondary-light);
            color: var(--color-primary);
            border-left: 3px solid var(--color-secondary);
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        .animate-fadeIn {
            animation: fadeIn 0.5s ease-in-out;
        }        /* Sidebar collapse styles */
        .sidebar {
            transition: width 0.3s ease;
            width: 16rem; /* w-64 equivalent */
            position: fixed;
            left: 0;
            top: 4rem; /* Below top navbar */
            height: calc(100vh - 4rem);
            z-index: 900;
            background: white;
            border-right: 1px solid #e5e7eb;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            overflow-y: auto; /* Enable scrolling for long menus */
        }
        .sidebar.collapsed {
            width: 4rem; /* w-16 equivalent */
        }
        .sidebar.collapsed .sidebar-text {
            display: none;
        }.sidebar.collapsed .sidebar-item {
            justify-content: center;
            padding: 0.75rem 0.5rem;
        }
          /* Remove hamburger button from sidebar header */
        .sidebar-header {
            display: none;
        }
        .sidebar.collapsed .sidebar-item {
            position: relative;
        }
        .sidebar.collapsed .sidebar-item:hover::after {
            content: attr(title);
            position: absolute;
            left: 100%;
            top: 50%;
            transform: translateY(-50%);
            background: #1f2937;
            color: white;
            padding: 0.5rem 0.75rem;
            border-radius: 0.375rem;
            white-space: nowrap;
            z-index: 1000;
            margin-left: 0.75rem;            font-size: 0.875rem;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            pointer-events: none;
        }

        /* Mobile responsiveness */
        @media (max-width: 1023px) {
            .sidebar {
                transform: translateX(-100%);
                width: 16rem;
                z-index: 1001;
            }
            .sidebar.mobile-open {
                transform: translateX(0);
            }
            .main-content {
                margin-left: 0;
            }
            .main-content.sidebar-collapsed {
                margin-left: 0;
            }
            .navbar-title {
                display: none;
            }
            .navbar-content {
                padding: 0 0.75rem;
            }
            .navbar-left {
                gap: 0.5rem;
            }
            .navbar-right {
                gap: 0.5rem;
            }
        }
        
        /* Extra small mobile devices */
        @media (max-width: 640px) {
            .navbar-content {
                padding: 0 0.5rem;
            }
            .navbar-left {
                gap: 0.25rem;
            }
            .navbar-right {
                gap: 0.25rem;
            }
            .navbar-logo img {
                height: 1.75rem;
            }
        }
        
        /* Mobile overlay */
        .mobile-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            display: none;
        }
        
        @media (max-width: 1023px) {
            .mobile-overlay.show {
                display: block;
            }
        }
          /* Tooltip para itens quando sidebar está recolhida */
    </style>
    {# O bloco extra_css agora está definido aqui para carregar estilos customizados #}
    {% block extra_css %}{% endblock %}
</head>
<body><body>
    {% if session.get('user') %}
    <!-- Top Navigation Bar -->
    <header class="top-navbar">
        <div class="navbar-content">
            <div class="navbar-left">
                <!-- Hamburger menu for sidebar toggle -->
                <button id="sidebar-toggle" class="navbar-hamburger" type="button">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
                    </svg>
                </button>
                
                <!-- Logo and app name -->
                <div class="navbar-logo">
                    <img src="{{ url_for('static', filename='medias/Logo_Unique.png') }}" alt="UniSystem">
                    <h1 class="navbar-title">UniSystem - Portal Aduaneiro</h1>
                </div>
            </div>            <div class="navbar-right">
                <!-- User info in top bar (desktop) -->
                <div class="navbar-user-info hidden md:flex">
                    <div class="flex items-center gap-3">
                        <!-- User avatar and info -->
                        <div class="flex items-center gap-2">
                            <div class="w-8 h-8 rounded-full bg-blue-100 flex items-center justify-center">
                                <svg class="w-5 h-5 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
                                </svg>
                            </div>
                            <div class="flex flex-col text-left">
                                <span class="text-sm font-medium">{{ session['user']['email'] }}</span>
                                <span class="text-xs text-blue-200 capitalize">
                                    {% if session['user']['role'] == 'cliente_unique' %}
                                        Cliente
                                    {% elif session['user']['role'] == 'admin' %}
                                        Administrador
                                    {% else %}
                                        {{ session['user']['role'] }}
                                    {% endif %}
                                </span>
                            </div>
                        </div>
                        
                        <!-- Logout button -->
                        <a href="{{ url_for('auth.logout') }}" 
                           title="Sair do sistema"
                           class="flex items-center gap-1 px-3 py-1.5 text-sm text-white bg-blue-800 hover:bg-blue-900 rounded-md transition-colors duration-200 border border-blue-700">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"></path>
                            </svg>
                            <span>Sair</span>
                        </a>
                    </div>
                </div>
                
                <!-- Mobile user info and controls -->
                <div class="flex items-center gap-2 md:hidden">
                    <!-- User avatar (mobile) -->
                    <div class="w-8 h-8 rounded-full bg-blue-100 flex items-center justify-center">
                        <svg class="w-5 h-5 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7 7z"></path>
                        </svg>
                    </div>
                    
                    <!-- Mobile logout button -->
                    <a href="{{ url_for('auth.logout') }}" 
                       title="Sair do sistema"
                       class="flex items-center justify-center w-8 h-8 text-white bg-blue-800 hover:bg-blue-900 rounded-md transition-colors duration-200">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"></path>
                        </svg>
                    </a>
                </div>
                
                <!-- Mobile menu button -->
                <button id="mobile-menu-toggle" class="navbar-hamburger lg:hidden" type="button">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
                    </svg>
                </button>
            </div>
        </div>
    </header>    <div class="flex">
        <!-- Mobile overlay -->
        <div id="mobile-overlay" class="mobile-overlay"></div>
          <!-- Sidebar -->
        <aside id="sidebar" class="sidebar hidden lg:block">
            <!-- Navigation menu -->
            <nav class="h-full px-3 py-4 space-y-1" id="sidebar-nav">
                <!-- Loading state -->
                <div class="text-center text-gray-500 py-4">
                    <div class="animate-spin rounded-full h-6 w-6 border-b-2 border-blue-600 mx-auto mb-3"></div>
                    <span class="sidebar-text text-sm">Carregando menu...</span>
                </div>
            </nav>
        </aside>
        
        <!-- Main content area -->
        <main id="main-content" class="main-content flex-1 overflow-x-hidden overflow-y-auto bg-gray-50">
            {% block content %}{% endblock %}
        </main>
    </div>
    {% else %}
    {% block auth_content %}{% endblock %}
    {% endif %}
      {% block extra_js %}{% endblock %}
      <script>
        // Sidebar toggle functionality
        let sidebarExpanded = true;
          function toggleSidebar() {
            const sidebar = document.getElementById('sidebar');
            const mainContent = document.getElementById('main-content');
            const hamburgerBtn = document.getElementById('sidebar-toggle');
              sidebarExpanded = !sidebarExpanded;
            
            if (sidebarExpanded) {
                sidebar.classList.remove('collapsed');
                mainContent.classList.remove('sidebar-collapsed');
            } else {
                sidebar.classList.add('collapsed');
                mainContent.classList.add('sidebar-collapsed');
            }
            
            // Store preference in localStorage
            localStorage.setItem('sidebarExpanded', sidebarExpanded);
        }
          // Initialize sidebar state from localStorage
        document.addEventListener('DOMContentLoaded', function() {
            const savedState = localStorage.getItem('sidebarExpanded');
            if (savedState !== null) {
                sidebarExpanded = savedState === 'true';
                if (!sidebarExpanded) {                    // Apply collapsed state without calling toggleSidebar to avoid double toggle
                    const sidebar = document.getElementById('sidebar');
                    const mainContent = document.getElementById('main-content');
                    
                    sidebar.classList.add('collapsed');
                    mainContent.classList.add('sidebar-collapsed');
                }
            }
            
            // Add event listener to hamburger button
            document.getElementById('sidebar-toggle')?.addEventListener('click', toggleSidebar);
        });        // Mobile menu functionality
        function toggleMobileMenu() {
            const sidebar = document.getElementById('sidebar');
            const overlay = document.getElementById('mobile-overlay');
            const isOpen = sidebar.classList.contains('mobile-open');
            
            if (isOpen) {
                sidebar.classList.remove('mobile-open');
                overlay.classList.remove('show');
            } else {
                sidebar.classList.add('mobile-open');
                overlay.classList.add('show');
            }
        }
        
        document.getElementById('mobile-menu-toggle')?.addEventListener('click', toggleMobileMenu);
        
        // Close mobile menu when clicking overlay
        document.getElementById('mobile-overlay')?.addEventListener('click', toggleMobileMenu);        // Hide mobile menu on window resize
        window.addEventListener('resize', function() {
            const sidebar = document.getElementById('sidebar');
            const overlay = document.getElementById('mobile-overlay');
            
            if (window.innerWidth >= 1024) {
                sidebar.classList.remove('mobile-open');
                sidebar.classList.remove('hidden');
                overlay.classList.remove('show');
            } else {
                sidebar.classList.remove('mobile-open');
                sidebar.classList.add('hidden');
                overlay.classList.remove('show');
            }
        });

        // Função global para carregar menu dinamicamente baseado nas permissões do usuário
        window.loadSidebarMenu = function() {
            console.log("Carregando menu lateral...");
            const sidebarNav = document.getElementById('sidebar-nav');
            if (!sidebarNav) {
                console.error("Elemento sidebar-nav não encontrado! Não é possível carregar o menu.");
                return;
            }
            
            // Adicionando mensagem visual para indicar carregamento
            sidebarNav.innerHTML = '<div class="text-center text-gray-500 py-2">Carregando menu...</div>';
            
            const currentRole = '{{ session.get("user", {}).get("role", "none") }}';
            const currentEndpoint = '{{ request.endpoint }}';
            console.log("Papel atual:", currentRole);
            console.log("Endpoint atual:", currentEndpoint);
            
            // Primeiro verificar se a sessão está válida
            console.log("Verificando sessão antes de carregar menu...");
            fetch('/paginas/check-session', {
                method: 'GET',
                headers: {
                    'Cache-Control': 'no-cache',
                    'Pragma': 'no-cache'
                }
            })
            .then(sessionResponse => {
                console.log("Resposta de verificação de sessão:", sessionResponse.status);
                if (!sessionResponse.ok) {
                    if (sessionResponse.status === 401) {
                        console.warn("Sessão expirada. Redirecionando para login...");
                        window.location.href = '/login';
                        throw new Error('Sessão expirada');
                    }
                    throw new Error('Erro na verificação da sessão');
                }
                return sessionResponse.json();
            })
            .then(sessionData => {
                if (sessionData.status !== 'success') {
                    throw new Error('Sessão inválida');
                }
                
                console.log("Sessão verificada com sucesso. Carregando menu...");
                console.log("Iniciando fetch para /paginas/api...");
                
                // Agora carregamos o menu com um timestamp para evitar cache
                const timestamp = new Date().getTime();
                return fetch(`/paginas/api?_=${timestamp}`, {
                    headers: {
                        'Cache-Control': 'no-cache',
                        'Pragma': 'no-cache'
                    }
                });
            })
            .then(response => {
                console.log("Resposta recebida:", response.status);
                if (!response.ok) {
                    if (response.status === 401) {
                        // Sessão expirada, redirecionar para página de login
                        console.warn("Sessão expirada. Redirecionando para login...");
                        window.location.href = '/login';
                        throw new Error('Sessão expirada. Redirecionando para login...');
                    }
                    throw new Error('Erro na resposta: ' + response.status);
                }
                console.log("Resposta OK, convertendo para JSON...");
                return response.json();
            }).then(data => {
                    console.log("Dados recebidos:", data);
                    if (data.status === 'success') {
                        const pages = data.data;
                        console.log(`Recebidas ${pages ? pages.length : 0} páginas do servidor`);
                        
                        // Limpar loader
                        sidebarNav.innerHTML = '';
                        
                        // Construir links de navegação
                        if (pages && pages.length > 0) {
                            pages.forEach(page => {
                                console.log("Processando página:", page.nome_pagina);
                                // As páginas já foram filtradas pelo servidor, não precisamos filtrar novamente
                                const link = document.createElement('a');
                                
                                // Se a página está ativa ou em manutenção
                                if (page.flg_ativo) {
                                    link.href = page.url_rota;
                                    link.className = `sidebar-item ${currentEndpoint === page.id_pagina + '.index' ? 'active' : ''}`;
                                } else {
                                    link.href = 'javascript:void(0)';  // Link desabilitado
                                    link.className = 'sidebar-item opacity-60 cursor-not-allowed';
                                }                                // Montar o link com ícone e texto
                                link.title = page.nome_pagina; // Para tooltip quando colapsado                                  // Criar div para o ícone
                                const iconDiv = document.createElement('div');
                                iconDiv.className = 'sidebar-icon';
                                
                                // Criar elemento i para Material Design Icons
                                const iconElement = document.createElement('i');
                                iconElement.className = 'text-xl'; // Tamanho do ícone (equivalente a w-6 h-6)
                                
                                if (page.icone && page.icone.trim()) {
                                    // Verificar se é uma classe MDI válida
                                    if (page.icone.startsWith('mdi-')) {
                                        iconElement.classList.add('mdi', page.icone);
                                        console.log(`MDI icon for ${page.nome_pagina}:`, page.icone);
                                    } else {
                                        // Fallback para ícones antigos (SVG paths) - tentar converter para MDI
                                        console.warn(`Ícone antigo detectado para ${page.nome_pagina}, usando ícone padrão`);
                                        iconElement.classList.add('mdi', 'mdi-file-document-outline');
                                    }
                                } else {
                                    // Ícone padrão se não houver ícone específico
                                    iconElement.classList.add('mdi', 'mdi-file-document-outline');
                                }
                                
                                iconDiv.appendChild(iconElement);
                                
                                // Criar span para o texto
                                const textSpan = document.createElement('span');
                                textSpan.className = 'sidebar-text';
                                textSpan.textContent = page.flg_ativo ? page.nome_pagina : page.nome_pagina + ' (' + page.mensagem_manutencao + ')';
                                  // Adicionar elementos ao link
                                link.appendChild(iconDiv);
                                link.appendChild(textSpan);
                                
                                // Adicionar ícone de aviso para páginas em manutenção
                                if (!page.flg_ativo) {
                                    const warningIcon = document.createElement('span');
                                    warningIcon.className = 'ml-1 text-yellow-500 sidebar-text';
                                    warningIcon.innerHTML = '<svg class="w-4 h-4 inline-block" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"></path></svg>';
                                    link.appendChild(warningIcon);
                                }
                                
                                // Adicionar evento para páginas em manutenção
                                if (!page.flg_ativo) {
                                    link.addEventListener('click', function(e) {
                                        e.preventDefault();
                                        alert(`A página ${page.nome_pagina} está temporariamente em manutenção.`);
                                    });
                                }
                                
                                sidebarNav.appendChild(link);
                            });
                        }
                        
                        // Se não tiver nenhuma página para mostrar
                        if (sidebarNav.children.length === 0) {
                            console.warn("Nenhuma página disponível para exibição");
                            sidebarNav.innerHTML = '<div class="text-center text-gray-500 py-2">Nenhuma página disponível.</div>';
                        }
                    } else {
                        console.error("Erro nos dados recebidos:", data);
                        sidebarNav.innerHTML = '<div class="text-center text-red-500 py-2">Erro ao carregar o menu.</div>';
                    }
                })        .catch(error => {
                    console.error('Erro ao carregar menu:', error);
                    sidebarNav.innerHTML = '<div class="text-center text-red-500 py-2">Erro ao carregar o menu.</div>';
                    
                    // Adicionar link para a página de debug em caso de erro
                    const debugLink = document.createElement('a');
                    debugLink.href = '/debug';
                    debugLink.className = 'block text-center text-blue-500 underline mt-2';
                    debugLink.innerText = 'Acessar diagnóstico do sistema';
                    sidebarNav.appendChild(debugLink);
                });
        }
    </script>
      <!-- Adicionar classe logged-in ao body quando usuário estiver logado -->
    {% if session.get('user') %}
    <script>
        document.body.classList.add('logged-in');
    </script>
    
    <!-- Script para gerenciamento de sessão -->
    <script src="{{ url_for('static', filename='js/session-handler.js') }}"></script>
    
    <!-- Sistema de Cache para Menu -->
    <script src="{{ url_for('static', filename='js/menu-cache.js') }}"></script>
      <!-- Sistema de Testes (apenas em desenvolvimento) -->
    {% if config.DEBUG %}
    <script src="{{ url_for('static', filename='js/menu-test.js') }}"></script>
    {% endif %}
    {% endif %}
    
    <!-- Inicialização automática para usuários logados -->
    {% if session.get('user') %}
    <script>
        // Aguarda o carregamento completo da página e dos scripts
        document.addEventListener('DOMContentLoaded', function() {
            console.log('[Base] Usuário logado detectado, aguardando inicialização do cache...');
            
            // Aguarda o sistema de cache estar pronto
            function waitForCache() {
                if (window.menuCache) {
                    console.log('[Base] Sistema de cache disponível');
                    return Promise.resolve();
                } else {
                    console.log('[Base] Aguardando sistema de cache...');
                    return new Promise(resolve => {
                        setTimeout(() => waitForCache().then(resolve), 100);
                    });
                }
            }
            
            // Inicializa o menu usando o cache
            waitForCache().then(() => {
                console.log('[Base] Inicializando menu via cache...');
                // O menu-cache.js já inicializa automaticamente no DOMContentLoaded
                // Apenas garantimos que está funcionando
                if (!window.menuCache.menuLoaded) {
                    setTimeout(() => {
                        if (!window.menuCache.menuLoaded) {
                            console.log('[Base] Forçando carregamento do menu...');
                            window.menuCache.loadMenu();
                        }
                    }, 500);
                }
            });
        });
    </script>
    {% endif %}
</body>
</html>