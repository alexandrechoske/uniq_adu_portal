{% extends "base.html" %}

{% block title %}Análise de Materiais - Portal UniSystem{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/materiais-simple.css') }}">
{% endblock %}

{% block content %}
<div class="materiais-container">
    <!-- Header -->
    <div class="materiais-header">
        <div>
            <h1 class="materiais-title">Análise de Materiais</h1>
            <p class="materiais-subtitle">Visão detalhada dos materiais importados</p>
        </div>
        <div>
            <span id="last-update">Carregando...</span>
        </div>
    </div>
    
    <!-- Filtros -->
    <div class="filters-section">
        <div class="filters-card">
            <div class="filters-header">
                <h3>🔍 Filtros</h3>
                <button id="clear-filters" class="btn btn-outline">Limpar</button>
            </div>
            <div class="filters-content">
                <!-- Filtros de Busca -->
                <div class="filter-section">
                    <h4 class="filter-section-title">🔍 Filtros de Busca</h4>
                    <div class="filter-row">
                        <div class="filter-group">
                            <label for="material-filter">Material:</label>
                            <select id="material-filter" name="material" class="filter-select">
                                <option value="">Todos os materiais</option>
                                <!-- Opções carregadas dinamicamente -->
                            </select>
                        </div>
                        <div class="filter-group">
                            <label for="cliente-filter">Cliente:</label>
                            <select id="cliente-filter" name="cliente" class="filter-select">
                                <option value="">Todos os clientes</option>
                                <!-- Opções carregadas dinamicamente -->
                            </select>
                        </div>
                        <div class="filter-group">
                            <label for="modal-filter">Modal:</label>
                            <select id="modal-filter" name="modal" class="filter-select">
                                <option value="">Todos os modais</option>
                                <option value="AÉREA">Aéreo</option>
                                <option value="MARÍTIMA">Marítimo</option>
                                <option value="RODOVIÁRIA">Terrestre</option>
                                <option value="N/I">N/I</option>
                            </select>
                        </div>
                    </div>
                </div>
                
                <!-- Filtros Temporais -->
                <div class="filter-section">
                    <h4 class="filter-section-title">📅 Filtros Temporais</h4>
                    <div class="filter-row">
                        <div class="filter-group">
                            <label for="data-inicio">Data Início:</label>
                            <input type="date" id="data-inicio" name="data_inicio" class="filter-input">
                        </div>
                        <div class="filter-group">
                            <label for="data-fim">Data Fim:</label>
                            <input type="date" id="data-fim" name="data_fim" class="filter-input">
                        </div>
                    </div>
                    
                    <!-- Filtros Rápidos -->
                    <div class="quick-filters">
                        <span class="quick-filters-label">Filtros rápidos:</span>
                        <button type="button" class="btn btn-quick" data-period="current-year">Ano Atual</button>
                        <button type="button" class="btn btn-quick" data-period="this-week">Esta Semana</button>
                        <button type="button" class="btn btn-quick" data-period="this-month">Este Mês</button>
                        <button type="button" class="btn btn-quick" data-period="3-months">3 Meses</button>
                        <button type="button" class="btn btn-quick" data-period="6-months">6 Meses</button>
                    </div>
                </div>
                
                <div class="filter-actions">
                    <button id="apply-filters" class="btn btn-primary">🔍 Aplicar Filtros</button>
                    <span id="filter-status" class="filter-status"></span>
                </div>
                
                <!-- Resumo dos Filtros Ativos -->
                <div id="active-filters-summary" class="active-filters-summary" style="display: none;">
                    <div class="summary-header">
                        <span class="summary-title">📋 Filtros Ativos:</span>
                        <button id="clear-active-filters" class="btn btn-sm btn-outline">✕ Limpar</button>
                    </div>
                    <div id="active-filters-content" class="summary-content"></div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- KPI Cards -->
    <div class="kpi-section">
        <div class="kpi-card">
            <div class="kpi-value" id="kpi-processos">-</div>
            <div class="kpi-label">Total de Processos</div>
        </div>
        <div class="kpi-card">
            <div class="kpi-value" id="kpi-materiais">-</div>
            <div class="kpi-label">Materiais Únicos</div>
        </div>
        <div class="kpi-card">
            <div class="kpi-value" id="kpi-valor">-</div>
            <div class="kpi-label">Valor Total (VMCV)</div>
        </div>
        <div class="kpi-card">
            <div class="kpi-value" id="kpi-custo">-</div>
            <div class="kpi-label">Custo Total</div>
        </div>
        <div class="kpi-card">
            <div class="kpi-value" id="kpi-ticket">-</div>
            <div class="kpi-label">Ticket Médio</div>
        </div>
        <div class="kpi-card">
            <div class="kpi-value" id="kpi-transit">-</div>
            <div class="kpi-label">Transit Time Médio</div>
        </div>
    </div>
    
    <!-- Em desenvolvimento -->
    <div class="development-section">
        <div class="alert alert-info">
            <h4>📊 Dashboard em Desenvolvimento</h4>
            <p>Os KPIs acima estão funcionais. Próximas funcionalidades:</p>
            <ul>
                <li>✅ KPIs básicos de materiais</li>
                <li>🔄 Gráfico de top materiais por valor</li>
                <li>🔄 Evolução temporal de materiais</li>
                <li>🔄 Análise por modal de transporte</li>
                <li>🔄 Tabela detalhada de materiais</li>
                <li>🔄 Filtros avançados</li>
            </ul>
            <div class="mt-3">
                <button id="refresh-data" class="btn btn-primary">🔄 Atualizar KPIs</button>
                <button id="load-from-cache" class="btn btn-secondary">💾 Carregar do Cache</button>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<!-- Materiais JavaScript -->
<script src="{{ url_for('static', filename='js/materiais-simple.js') }}"></script>
{% endblock %}
