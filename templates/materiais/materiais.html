{% extends "base.html" %}

{% block title %}An√°lise de Materiais - Portal UniSystem{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/materiais.css') }}">
{% endblock %}

{% block content %}
<div class="materiais-container">
    <!-- Header -->
    <div class="materiais-header">
        <div class="header-left">
            <h1 class="materiais-title">An√°lise de Materiais</h1>
            <p class="materiais-subtitle">Vis√£o detalhada dos materiais importados</p>
        </div>
        <div class="header-right">
            <button id="open-filters" class="btn btn-primary">üîç Filtros</button>
            <span id="last-update" class="last-update">Carregando...</span>
        </div>
    </div>
    
    <!-- KPI Cards -->
    <div class="kpi-section">
        <div class="kpi-card">
            <div class="kpi-value" id="kpi-total-processos">-</div>
            <div class="kpi-label">Total de Processos</div>
        </div>
        <div class="kpi-card">
            <div class="kpi-value" id="kpi-total-materiais">-</div>
            <div class="kpi-label">Tipos de Materiais</div>
        </div>
        <div class="kpi-card">
            <div class="kpi-value" id="kpi-valor-total">-</div>
            <div class="kpi-label">Valor Total CIF (R$)</div>
        </div>
        <div class="kpi-card">
            <div class="kpi-value" id="kpi-custo-total">-</div>
            <div class="kpi-label">Custo Total (R$)</div>
        </div>
        <div class="kpi-card">
            <div class="kpi-value" id="kpi-ticket-medio">-</div>
            <div class="kpi-label">Ticket M√©dio (R$)</div>
        </div>
        <div class="kpi-card">
            <div class="kpi-value" id="kpi-transit-time">-</div>
            <div class="kpi-label">Transit Time M√©dio (dias)</div>
        </div>
    </div>
    
    <!-- Charts Grid -->
    <div class="charts-grid-main">
        <!-- Top Materiais Chart -->
        <div class="chart-section">
            <div class="chart-header">
                <h2 class="chart-title">Top 10 Materiais por Quantidade</h2>
                <div class="chart-controls">
                    <button id="refresh-chart" class="btn btn-secondary">üîÑ Atualizar</button>
                </div>
            </div>
            <div class="chart-container">
                <canvas id="top-materiais-chart" class="chart-canvas"></canvas>
            </div>
        </div>
        
        <!-- Evolu√ß√£o Mensal Chart -->
        <div class="chart-section">
            <div class="chart-header">
                <h2 class="chart-title">Evolu√ß√£o Mensal - Top 3 Materiais</h2>
            </div>
            <div class="chart-container">
                <canvas id="evolucao-mensal-chart" class="chart-canvas"></canvas>
            </div>
        </div>
    </div>
    
    <!-- Second Row of Charts -->
    <div class="charts-grid-secondary">
        <!-- Modal Distribution Chart -->
        <div class="chart-section">
            <div class="chart-header">
                <h2 class="chart-title">Distribui√ß√£o por Modal</h2>
            </div>
            <div class="chart-container">
                <canvas id="modal-chart" class="chart-canvas"></canvas>
            </div>
        </div>
        
        <!-- Canal Distribution Chart -->
        <div class="chart-section">
            <div class="chart-header">
                <h2 class="chart-title">Distribui√ß√£o por Canal</h2>
            </div>
            <div class="chart-container">
                <canvas id="canal-chart" class="chart-canvas"></canvas>
            </div>
        </div>
    </div>
    
    <!-- Third Row of Charts -->
    <div class="charts-grid-third">
        <!-- Transit Time por Material Chart -->
        <div class="chart-section">
            <div class="chart-header">
                <h2 class="chart-title">Transit Time por Material</h2>
            </div>
            <div class="chart-container">
                <canvas id="transit-time-chart" class="chart-canvas"></canvas>
            </div>
        </div>
        
        <!-- Principais Materiais Table -->
        <div class="chart-section">
            <div class="chart-header">
                <h2 class="chart-title">Principais Materiais</h2>
            </div>
            <div class="table-container">
                <table id="principais-materiais-table" class="data-table">
                    <thead>
                        <tr>
                            <th>Material</th>
                            <th>Qtd Processos</th>
                            <th>Custo Total (R$)</th>
                            <th>Pr√≥xima Chegada</th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- Dados carregados dinamicamente -->
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- Filter Modal -->
    <div id="filter-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">üîç Filtros de Materiais</h2>
                <span class="close" id="close-modal">&times;</span>
            </div>
            <div class="modal-body">
                <!-- Filtros de Data -->
                <div class="filter-section">
                    <h4 class="filter-section-title">üìÖ Per√≠odo</h4>
                    <div class="filter-row">
                        <div class="filter-group">
                            <label for="data-inicio">Data In√≠cio:</label>
                            <input type="date" id="data-inicio" name="data_inicio" class="filter-input">
                        </div>
                        <div class="filter-group">
                            <label for="data-fim">Data Fim:</label>
                            <input type="date" id="data-fim" name="data_fim" class="filter-input">
                        </div>
                    </div>
                    
                    <!-- Filtros R√°pidos -->
                    <div class="quick-filters">
                        <span class="quick-filters-label">Filtros r√°pidos:</span>
                        <button type="button" class="btn btn-quick" data-period="current-year">Ano Atual</button>
                        <button type="button" class="btn btn-quick" data-period="this-week">Esta Semana</button>
                        <button type="button" class="btn btn-quick" data-period="this-month">Este M√™s</button>
                        <button type="button" class="btn btn-quick" data-period="3-months">3 Meses</button>
                        <button type="button" class="btn btn-quick" data-period="6-months">6 Meses</button>
                    </div>
                </div>
                
                <!-- Filtros de Busca -->
                <div class="filter-section">
                    <h4 class="filter-section-title">üîç Filtros de Busca</h4>
                    <div class="filter-row">
                        <div class="filter-group">
                            <label for="material-filter">Material:</label>
                            <select id="material-filter" name="material" class="filter-select">
                                <option value="">Todos os materiais</option>
                                <!-- Categorias principais -->
                                <optgroup label="üìÇ Categorias">
                                    <option value="FERRAMENTA">üîß Ferramentas</option>
                                    <option value="COMPRESSOR">üî© Compressores</option>
                                    <option value="MOTOR">‚ö° Motores</option>
                                    <option value="FILTRO">üîΩ Filtros</option>
                                    <option value="PE√áA">üîß Pe√ßas/Componentes</option>
                                    <option value="V√ÅLVULA">üîò V√°lvulas</option>
                                    <option value="ROLAMENTO">‚öôÔ∏è Rolamentos</option>
                                    <option value="EQUIPAMENTO">üì¶ Equipamentos</option>
                                </optgroup>
                                <!-- Op√ß√µes carregadas dinamicamente -->
                                <optgroup label="üìã Materiais Espec√≠ficos" id="materiais-dinamicos">
                                </optgroup>
                            </select>
                        </div>
                        <div class="filter-group">
                            <label for="cliente-filter">Cliente:</label>
                            <select id="cliente-filter" name="cliente" class="filter-select">
                                <option value="">Todos os clientes</option>
                                <!-- Op√ß√µes carregadas dinamicamente -->
                            </select>
                        </div>
                    </div>
                </div>
                
                <!-- Filtros de Log√≠stica -->
                <div class="filter-section">
                    <h4 class="filter-section-title">üöö Log√≠stica</h4>
                    <div class="filter-row">
                        <div class="filter-group">
                            <label for="modal-filter">Modal:</label>
                            <select id="modal-filter" name="modal" class="filter-select">
                                <option value="">Todos os modais</option>
                                <option value="A√âREA">‚úàÔ∏è A√©reo</option>
                                <option value="MAR√çTIMA">üö¢ Mar√≠timo</option>
                                <option value="TERRESTRE">üöõ Terrestre</option>
                            </select>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button id="clear-filters" class="btn btn-outline">Limpar Filtros</button>
                <button id="apply-filters" class="btn btn-primary">Aplicar Filtros</button>
            </div>
        </div>
    </div>

    <!-- Tabela de Detalhamento -->
    <div class="table-section">
        <div class="table-header">
            <h2 class="table-title">Detalhamento dos Processos</h2>
            <div class="table-controls">
                <button id="export-data" class="btn btn-secondary">üìä Exportar</button>
            </div>
        </div>
        <div class="table-container">
            <table id="detalhamento-table" class="data-table">
                <thead>
                    <tr>
                        <th>Data Abertura</th>
                        <th>N√∫mero Pedido</th>
                        <th>Cliente</th>
                        <th>Material</th>
                        <th>Data Embarque</th>
                        <th>Data Chegada</th>
                        <th>Status</th>
                        <th>Canal</th>
                        <th>Valor (R$)</th>
                    </tr>
                </thead>
                <tbody>
                    <!-- Dados carregados dinamicamente -->
                </tbody>
            </table>
        </div>
    </div>
    
    <!-- Loading Overlay -->
    <div id="loading-overlay" class="loading-overlay">
        <div class="loading-spinner">
            <div class="spinner"></div>
            <p>Carregando dados...</p>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns"></script>
<script src="{{ url_for('static', filename='js/materiais.js') }}"></script>
{% endblock %}
